<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ch03 - MySQL的备份与恢复 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="mysql,mysql备份与恢复"><meta name=description content="备份数据库的意义 运维工作到底是什么工作，到底是做什么？
运维工作简单的概括就两件事：
一是保护公司的数据；二是网站7*24小时提供服务。
那么对数据丢失一部分和网站7*24小时提供服务那个更重要呢？
都很重要，只是说相比哪个更为重要？这个具体要看业务个公司。例如：银行、金融行业，数据是最重要的，一条都不能丢，可能宕机停机影响就没那么大。百度搜索，腾讯qq聊天记录丢失了几万条数据，都不算啥。
对于数据来讲，数据最核心的就是数据库数据。
备份单个数据库练习多种参数的使用 MySQL数据库自带了一个很好用的备份命令，就是mysqldump，它的基本使用如下：
sql 1 mysqldump -u UserName -p PassWord dbName > backName.sql 备份库 sql 1 mysqldump -S /data/3306/mysql.sock -uroot -p test>mysql.sql 检查备份结果
sql 1 2 3 4 5 6 7 8 9 10 11 12 $ egrep -v &#34;#|\*|--|^$&#34; ./mysql.sql DROP TABLE IF EXISTS `test1`; CREATE TABLE `test1` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `num1` varchar(20) NOT NULL, `num2` varchar(20) NOT NULL, `num3` varchar(20) NOT NULL, `num4` int(11) NOT NULL DEFAULT '0' COMMENT 'test1', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2000001 DEFAULT CHARSET=utf8; LOCK TABLES `test1` WRITE; INSERT INTO `test1` VALUES (1,'1455577','9779520','4530868',0), 注：因为导出时的格式没有加字符集，一般恢复到数据库里会正常，只是系统外查看不正常而已。另外，insert是批量插入的方式，这样在恢复时效率很高。"><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2017/05/ch3-mysql-backup-and-restore/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2017/05/ch3-mysql-backup-and-restore/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="ch03 - MySQL的备份与恢复"><meta property="og:description" content="备份数据库的意义 运维工作到底是什么工作，到底是做什么？
运维工作简单的概括就两件事：
一是保护公司的数据；二是网站7*24小时提供服务。
那么对数据丢失一部分和网站7*24小时提供服务那个更重要呢？
都很重要，只是说相比哪个更为重要？这个具体要看业务个公司。例如：银行、金融行业，数据是最重要的，一条都不能丢，可能宕机停机影响就没那么大。百度搜索，腾讯qq聊天记录丢失了几万条数据，都不算啥。
对于数据来讲，数据最核心的就是数据库数据。
备份单个数据库练习多种参数的使用 MySQL数据库自带了一个很好用的备份命令，就是mysqldump，它的基本使用如下：
sql 1 mysqldump -u UserName -p PassWord dbName > backName.sql 备份库 sql 1 mysqldump -S /data/3306/mysql.sock -uroot -p test>mysql.sql 检查备份结果
sql 1 2 3 4 5 6 7 8 9 10 11 12 $ egrep -v &#34;#|\*|--|^$&#34; ./mysql.sql DROP TABLE IF EXISTS `test1`; CREATE TABLE `test1` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `num1` varchar(20) NOT NULL, `num2` varchar(20) NOT NULL, `num3` varchar(20) NOT NULL, `num4` int(11) NOT NULL DEFAULT '0' COMMENT 'test1', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2000001 DEFAULT CHARSET=utf8; LOCK TABLES `test1` WRITE; INSERT INTO `test1` VALUES (1,'1455577','9779520','4530868',0), 注：因为导出时的格式没有加字符集，一般恢复到数据库里会正常，只是系统外查看不正常而已。另外，insert是批量插入的方式，这样在恢复时效率很高。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2017/05/ch3-mysql-backup-and-restore/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-05-14T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-12T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="ch03 - MySQL的备份与恢复"><meta name=twitter:description content="备份数据库的意义 运维工作到底是什么工作，到底是做什么？
运维工作简单的概括就两件事：
一是保护公司的数据；二是网站7*24小时提供服务。
那么对数据丢失一部分和网站7*24小时提供服务那个更重要呢？
都很重要，只是说相比哪个更为重要？这个具体要看业务个公司。例如：银行、金融行业，数据是最重要的，一条都不能丢，可能宕机停机影响就没那么大。百度搜索，腾讯qq聊天记录丢失了几万条数据，都不算啥。
对于数据来讲，数据最核心的就是数据库数据。
备份单个数据库练习多种参数的使用 MySQL数据库自带了一个很好用的备份命令，就是mysqldump，它的基本使用如下：
sql 1 mysqldump -u UserName -p PassWord dbName > backName.sql 备份库 sql 1 mysqldump -S /data/3306/mysql.sock -uroot -p test>mysql.sql 检查备份结果
sql 1 2 3 4 5 6 7 8 9 10 11 12 $ egrep -v &#34;#|\*|--|^$&#34; ./mysql.sql DROP TABLE IF EXISTS `test1`; CREATE TABLE `test1` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `num1` varchar(20) NOT NULL, `num2` varchar(20) NOT NULL, `num3` varchar(20) NOT NULL, `num4` int(11) NOT NULL DEFAULT '0' COMMENT 'test1', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2000001 DEFAULT CHARSET=utf8; LOCK TABLES `test1` WRITE; INSERT INTO `test1` VALUES (1,'1455577','9779520','4530868',0), 注：因为导出时的格式没有加字符集，一般恢复到数据库里会正常，只是系统外查看不正常而已。另外，insert是批量插入的方式，这样在恢复时效率很高。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"ch03 - MySQL的备份与恢复","item":"https://www.oomkill.com/2017/05/ch3-mysql-backup-and-restore/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ch03 - MySQL的备份与恢复","name":"ch03 - MySQL的备份与恢复","description":"备份数据库的意义 运维工作到底是什么工作，到底是做什么？\n运维工作简单的概括就两件事：\n一是保护公司的数据；二是网站7*24小时提供服务。\n那么对数据丢失一部分和网站7*24小时提供服务那个更重要呢？\n都很重要，只是说相比哪个更为重要？这个具体要看业务个公司。例如：银行、金融行业，数据是最重要的，一条都不能丢，可能宕机停机影响就没那么大。百度搜索，腾讯qq聊天记录丢失了几万条数据，都不算啥。\n对于数据来讲，数据最核心的就是数据库数据。\n备份单个数据库练习多种参数的使用 MySQL数据库自带了一个很好用的备份命令，就是mysqldump，它的基本使用如下：\nsql 1 mysqldump -u UserName -p PassWord dbName \u0026gt; backName.sql 备份库 sql 1 mysqldump -S /data/3306/mysql.sock -uroot -p test\u0026gt;mysql.sql 检查备份结果\nsql 1 2 3 4 5 6 7 8 9 10 11 12 $ egrep -v \u0026#34;#|\\*|--|^$\u0026#34; ./mysql.sql DROP TABLE IF EXISTS `test1`; CREATE TABLE `test1` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `num1` varchar(20) NOT NULL, `num2` varchar(20) NOT NULL, `num3` varchar(20) NOT NULL, `num4` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;test1\u0026#39;, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2000001 DEFAULT CHARSET=utf8; LOCK TABLES `test1` WRITE; INSERT INTO `test1` VALUES (1,\u0026#39;1455577\u0026#39;,\u0026#39;9779520\u0026#39;,\u0026#39;4530868\u0026#39;,0), 注：因为导出时的格式没有加字符集，一般恢复到数据库里会正常，只是系统外查看不正常而已。另外，insert是批量插入的方式，这样在恢复时效率很高。","keywords":["mysql","mysql备份与恢复"],"articleBody":"备份数据库的意义 运维工作到底是什么工作，到底是做什么？\n运维工作简单的概括就两件事：\n一是保护公司的数据；二是网站7*24小时提供服务。\n那么对数据丢失一部分和网站7*24小时提供服务那个更重要呢？\n都很重要，只是说相比哪个更为重要？这个具体要看业务个公司。例如：银行、金融行业，数据是最重要的，一条都不能丢，可能宕机停机影响就没那么大。百度搜索，腾讯qq聊天记录丢失了几万条数据，都不算啥。\n对于数据来讲，数据最核心的就是数据库数据。\n备份单个数据库练习多种参数的使用 MySQL数据库自带了一个很好用的备份命令，就是mysqldump，它的基本使用如下：\nsql 1 mysqldump -u UserName -p PassWord dbName \u003e backName.sql 备份库 sql 1 mysqldump -S /data/3306/mysql.sock -uroot -p test\u003emysql.sql 检查备份结果\nsql 1 2 3 4 5 6 7 8 9 10 11 12 $ egrep -v \"#|\\*|--|^$\" ./mysql.sql DROP TABLE IF EXISTS `test1`; CREATE TABLE `test1` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `num1` varchar(20) NOT NULL, `num2` varchar(20) NOT NULL, `num3` varchar(20) NOT NULL, `num4` int(11) NOT NULL DEFAULT '0' COMMENT 'test1', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2000001 DEFAULT CHARSET=utf8; LOCK TABLES `test1` WRITE; INSERT INTO `test1` VALUES (1,'1455577','9779520','4530868',0), 注：因为导出时的格式没有加字符集，一般恢复到数据库里会正常，只是系统外查看不正常而已。另外，insert是批量插入的方式，这样在恢复时效率很高。\n根据查看的结果，我们看到了已备份的表结构语句及插入的数据整合的sql语句，但是中文数据乱码了。\n设置字符集参数备份解决乱码问题 查看备份前数据库客户端及服务器端的字符集设置\nsql 1 2 3 4 5 6 7 8 9 10 11 12 13 mysql\u003e show variables like \"character%\" +---------------------------+-----------------------------------+ | Variable_name | Value | +---------------------------+-----------------------------------+ | character_set_client | utf8 | | character_set_connection\t| utf8 | | character_set_database | utf8 | | character_set_filesystem\t| binary | | character_set_results | utf8 | | character_set_server | utf8 | | character_set_system | utf8 | | character_sets_dir | /app/mysql-5.5.54/share/charsets/ | +---------------------------+-----------------------------------+ 指定对应的字符集备份，这里为--default-character-set=utf8\ntext 1 mysqldump -uroot -p111 --default-character-set=utf8 t1 \u003e t.sql -S /data/3306/mysql.sock 备份时加-B参数，增加创建库与选择库 sql 1 2 3 -- Current Database: `t1` CREATE DATABASE /*!32312 IF NOT EXISTS*/ `t1` /*!40100| USE `t1`; 优化配置文件大小减少输出注释（debug调试） 利用mysqldump的--compact参数优化下备份结果\nbash 1 2 $ mysqldump -uroot -p111 --default-character-set=utf8 --compact -B t1 \u003e t_b.sql $ cat t_b.sql sql 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 CREATE DATABASE /*!32312 IF NOT EXISTS*/ `t1` /*!40100 DEFAULT CHARACTER SET utf8 */; USE `t1`; /*!40101 SET @saved_cs_client = @@character_set_client */; /*!40101 SET character_set_client = utf8 */; CREATE TABLE `test1` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `num1` varchar(20) NOT NULL, `num2` varchar(20) NOT NULL, `num3` varchar(20) NOT NULL, `num4` int(11) NOT NULL DEFAULT '0' COMMENT 'test1', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2000031 DEFAULT CHARSET=utf8; /*!40101 SET character_set_client = @saved_cs_client */; INSERT INTO `test1` VALUES (2000001,'690938','794482','1899596',0),(2000002,'7114536','9873892','8025852',0),(2000003,'507584','8460367','779079',0),(2000004,'8514298','234250','5628359',0),(2000005,'7439042','310137','9233557',0),(2000006,'5237373','8486196','6718861',0),(2000007,'8135719','522012','8202901',0),(2000008,'9448472','2633656','4822864',0),(2000009,'6213355','6598180','4350835',0),(2000010,'1959635','6745673','7849459',0),(2000011,'9010275','1503001','484179',0),(2000012,'7911894','8106930','6798971',0),(2000013,'9674065','7973412','844865',0),(2000014,'304088','8985848','4016974',0),(2000015,'3127327','3585711','8546578',0),(2000016,'1975754','4239037','5267926',0),(2000017,'3622517','2308806','676480',0),(2000018,'6455983','250474','1884422',0),(2000019,'8670686','7700168','2488781',0),(2000020,'9343400','9250657','8223086',0),(2000021,'3363461','2148048','649856',0),(2000022,'6805137','2076115','9965166',0),(2000023,'3597485','8091927','9667180',0),(2000024,'4060121','1299065','4314962',0),(2000025,'7677614','5443186','4183087',0),(2000026,'4585879','380131','8143022',0),(2000027,'9574716','3444513','8498418',0),(2000028,'2158552','5297508','11882',0),(2000029,'4166888','798795','1493311',0),(2000030,'5070170','870919','9144083',0); –compact参数说明：\n（测试时用的比较多）可以优化输出内容的大小，让容量更少，适合调试。\nsql 1 2 3 4 --compact\tGive less verbose output (useful for debugging).\tDisables structure comments and header/footer contructs. Enables options --skip-add-drop-table --no-set-names --skip-disable-keys --skip-add-locks 参数说明：该选项使得输出内容更简介，不包括默认选项中各种注释。有如下几个参数的功能。\n--skip-add-drop-table\n--no-set-names\n--skip-disable-keys\n--skip-add-locks\n压缩备份的数据 sql 1 2 3 4 5 6 --- 输出时用管道进行备份，压缩效率将近3倍 --- 这个保存为一个压缩文件 mysqldump -S /data/3306/mysql.sock -uroot -p111 -B t1|gzip \u003et1.sql.gz 1360 t1.sql.g 3365 t2.sql 小结：\n备份数据使用-B参数，会在备份数据中增加建库及use库的语句 备份数据使用-B参数，后面可以直接接多个库名。 共gzip对备份的数据亚索 debug时可以用–compact减少输出，但不用于生产 指定字符集备份用–default-character-set=utf8（一般不用） mysqldump的工作原理 利用mysqldump命令备份数据的过程，实际上就是把数据从mysql库里以逻辑的sql语句的形式直接输出或者生成备份的文件的过程。\n提示：使用mysqldump是把数据库的数据导出通过sql语句的形式存储，这种备份方式称之为逻辑备份，效率不是很高，一般50G以内的数据。\n其他备份方式：物理备份：cp tar（停库），xtrabackup物理热备份。 备份多个库及多个参数\nsql 1 2 mysqldump -uroot -p111 -S /data/3306/mysql.sock --compact \\ -B test t1|gzip\u003e/data/test1.sql -B参数说明\nbash 1 2 3 4 5 6 7 8 9 -B，参数是关键，表示接多个库并且增加use db和create database db的信息 -B, --databases Dump several databases. Note the difference in usage; in this case no tables are given. All name arguments are regarded as database names. 'USE db_name;' will be included in the output. # 用于导出多个数据库，注意这种情况系没有表。所有的名称参数都被认作为是数据库。 # 每个数据库名以空格隔开，将使用的数据库名称包含到输出里 # 当-B后的数据库列全时，同-A参数。 分库备份 分库备份实际上就是执行一个备份语句备份一个库，如果数据库里有多个库，就执行多条相同的备份单个库的备份语句就可以备份多个库了，注意每个库都可以用对应备份的库作为库名，结尾加.sql。备份多个库的命令如下：\nmysqldump -uroot -p111 -B oldboy;\nmysqldump -uroot -p111 -B test;\n….\n….\n分库备份法1：\nsql 1 2 3 4 5 6 7 8 9 10 11 12 13 14 mysql -uroot -p111 -S /data/3306/mysql.sock \\ -e 'show databases;'|\\ egrep -v \"Database|_schema|mysql\"|\\ sed -r 's#^(.*)#mysqldump -uroot -p111 -S /data/3306/mysql.sock \\1#g' mysql -uroot -p111 -S /data/3306/mysql.sock bingbing mysql -uroot -p111 -S /data/3306/mysql.sock t1 mysql -uroot -p111 -S /data/3306/mysql.sock test -- 将结果交给bash mysql -uroot -p111 -S /data/3306/mysql.sock \\ -e 'show databases;'|egrep -v \"Database|_schema|mysql\"|\\ sed -r 's#^(.*)#mysqldump -uroot -p111 -S /data/3306/mysql.sock -B \\1|gzip\u003e\\1.sql.gz#g' \\ |bash 法2：\n见分库分表备份视频：http://edu.51cto.com/course/course_id-808.html\n分库备份的意义何在？\n有时一个企业的数据库里会有多个库，例如（www.bbs，blog），但是出问题的时候很可能是某一个库，如果在备份时把所有的库都备份成了一个数据文件的话，回复某一个库的数据是就比较麻烦了。\n备份单个表 语法：\nbash 1 2 mysqldump -uuserName -ppassWord dbName tableName \u003e/data.sql mysqldump -uuserName -ppassWord dbName tableName1 tableName2.. \u003e/data.sql 提示：不能加-B参数了，因为库后面就是表了。\n企业需求：一个库里有大表有小标，有时可能需要只回复某一个小表，上述的多表备份很难拆开，就想没有分库那样导致恢复某一个小表很麻烦。\n那么又如何进行分表备份呢？如下，和分库的思想一样，每执行一条语句备份一个表，生成不同的数据文件即可。如下：\nbash 1 2 3 mysql -uroot -p111 -e 'use test; show tables;' \\ |egrep -v 'Tables_in_test' \\ |sed -r 's#^(.*)#mysqldump -uroot -p111 --compact test \\1\u003e\\1.sq$g'|bash 分表备份缺点：文件多，很碎\n备一个完整全备，在做一个分库分表备份\r脚本批量备份恢复多个SQL文件\r面试题：多个库或者多个表备份到一块了，如何恢复单个库或者表？\n解答：\n第三方测试库，导入到库里，然后把需要的备份出来，恢复到正式库里。 单表：grep表名 bak.sql\u003etab_name。 实现分库分表备份 备份数据表结构 利用mysqldump -d参数只备份表的结构，例：备份oldboy库的所有表的结构\nsql 1 mysqldump -uroot -p111 -d --compact -B test \u003e t.sql 如果只导出数据则用-t\nsql 1 mysqldump -uroot -p111 -S /data/3306/mysql.sock -t --compact -B test \u003e 1t.sql -T --tab=path：语句与数据分离，数据为文本。\nsql 1 mysqldump -uroot -p111 -S /data/3306/mysql.sock t1 test1 -T /data 注意只能对表进行分离，对数据库进行分离提示如下：\nbash 1 2 $ mysqldump -uroot -p111 -S /data/3306/mysql.sock -B t1 -T /data mysqldump: --databases or --all-databases can't be used with --tab. 小结：\n-B备份多个库（并添加create和use语句） -d只备份库表结构 -t只备份数据（sql语句形式） -T分离表和数据成不同的文件，数据是文本，非SQL语句 刷新binlog参数 mysqldump用于定时对某一时刻的数据的全备份，例如：00点进行备份bak.sql.gz\n增量备份：当有数据写入到数据库时，还会同时把更新的SQL语句写入到对应的文件里，这个文件就叫做binlog。\n比如说晚上0点做备份， 10点宕机了，0-10点的数据就丢失了\n10点前丢失数据需要恢复的数据：\n00点时刻备份的bak.sql.gz数据还原到数据库，这个时候数据恢复到了00点 00-10点数据，就要从binlog里恢复。 binlog作用 记录数据库更新的sql语句，不记录show select等，只是记录对数据库记录变更的二进制文件。\n在mysql数据库当中，当你做一个全备之后到出问题的时刻，要想恢复，就是全备+全备之后的所有binlog。\n定界binlog 问题：怎么界定备份之后和binlog文件之间连接的很紧密不多也不少。\n通过文件的日志点。可以通过-F做一个区分。\n只要我们做了备份，然后就刷新binlog，将来恢复的就是130以下的。130以上的包里面就包含了 binlog日志切割：确定全备和增量的结界点-F刷新binlog日志，生成新日志文件，将来增量恢复从这个新日志文件开始。\nbinglog文件生效需要一个参数：log-bin log-bin=/data/3306/mysql-bin\nbash 1 2 3 4 5 6 7 8 9 10 11 12 $ ll # ←备份前，查看目录binlog文件 mysql-bin.000316 mysql-bin.000317 mysql-bin.index mysqldump -uroot -p111 -S /data/3306/mysql.sock --compact -B t1 \u003e t1.sql -F $ ll #←在刷新之后可以看到binlog文件增加了 mysql-bin.000316 mysql-bin.000317 mysql-bin.000318 mysql-bin.index --master-data 在备份语句里添加 CHANGE MASTER 语句及 binlog 文件及位置点信息\n值1，为可执行的CHANGE MASTER语句\n值2，为注释的--CHANGE MASTER语句\n注：--master-data除了增量恢复确定临界点外，做主从复制时作用更大\nbash 1 2 3 4 5 # 不加--master-data语句 mysqldump -uroot -p111 --compact -B t1 \u003e t1.sql cat t1.sql CREATE DATABASE /*!32312 IF NOT EXISTS*/ `t1` /*!40100 DEFAULT CHARACTER SET utf8 */; sql 1 2 3 4 5 6 7 -- 加上master-data语句后 mysqldump -uroot -p111 --compact -B t1 \u003e t1.sql --master-data=1 cat t1.sql CHANGE MASTER TO MASTER_LOG_FILE='mysql-bin.000318', MASTER_LOG_POS=107; CREATE DATABASE /*!32312 IF NOT EXISTS*/ `t1` /*!40100 DEFAULT CHARACTER SET utf8 */; bash 1 2 $ mysqldump -uroot -p111 --compact -B t1 \u003e t1.sql --master-data=2 $ cat t1.sql sql 1 -- CHANGE MASTER TO MASTER_LOG_FILE='mysql-bin.000318', MASTER_LOG_POS=107; mysqldump关键参数说明 参数 说明 -B 指定多个库，增加建库语句和use语句。 –compact 去掉注释，适合调试输出，生产不适用 -A 备份所有库 -F 刷新binlog日志，生成新文件，将来增量恢复从这个文件开始。 –master-data 增加binlog日志文件名及对应的位置点（即CHANGE MASTER语句）。–mater-data=1不注释 2注释 -x –lock-all-tables -l –lock-tables lock all tables for read -d 只备份数据，无表结构，SQL语句形式。 -t 只备份数据，无库表结构，SQL语句形式。 -T 库表和数据分离不同文件，数据是文本形式。 –single-transaction 适合innodb事务数据库备份 -q --quick don’t bufferquery dump directly to stdout (Defaults to on; use –skip-quick to disable) 说明：innodb表在备份时，通常启用选线–single-transaction来保证备份的一致性，实际上它的工作原理是设定本次会话的隔离级别为REPEATABLE READ，确保本次会话（dump）时，不会看到其他会话已经提交了的数据。\n生产场景不同引擎mysqldump备份命令 myisam引擎企业生产备份，命令（适合所有引擎或混合引擎）： sh 1 mysqldump -uroot -p111 -A -B -F -R --master-data=2 -x --events|gzip \u003e /data/all.sql.gz 提示：-F也可以不用，与–，master-data有写重复\ninnodb引擎企业生产备份命令：推荐使用 sh 1 mysqldump -uroot -p111 -A -B -F -R --master-data=2 --events --single-transaction|gzip \u003e/data/all.sql.gz –master-data作用： 使用–master-data=2进行备份文件会增加如下内容：适合普通备份增量恢复 sh 1 --CHANGE MASTER TO MASTER_LOG_FILE='mysql-bin.00020', MASTER_LOGZ_POS=1191 使用–maste-data=1进行备份文件会增加如下内容：更适合主从复制 sh 1 CHANGE MASTER TO MASTER_LOG_FILE='mysql-bin.00020', MASTER_LOGZ_POS=1191 锁表的原理： innodb有acid的特性\ndump命令是看不到后面生成的数据，只能看到执行这个命令时所有数据之前的这个数据\n事务引擎不锁表备份原理：–single-transaction 会话隔离\n额外补充：\nmysqldump逻辑备份说明 缺点：效率不是特别高\n优点：简单、方便、可靠、迁移。\n超过50G可选方案 恢复数据到数据库的时候，认为通过SQL语句将数据删除的时候，做主从复制的时候\n恢复数据库实战 数据库恢复事项\n数据恢复和字符集关联很大，如果字符集不正确会导致恢复的数据乱码。 mysql命令以及source命令恢复数据可的原理就是把文件的SQL语句，在数据库里重新执行过程。\n利用source命令恢复数据库。 进入mysql数据库控制台，mysql -uroot -p登陆后\nuse database;\n然后使用source xx.sql，后面参数为脚本文件（如这里用到的sql）\nsource 2.sql 这个文件是系统路径，默认是登陆mysql前的系统路径\n提示：\nsource数据恢复和字符集关联很大，如果字符集不正确会导致恢复的数据乱码。\rutf8数据库，那么恢复的文件格式需要为utf8无bom头。\r利用mysql命令恢复（标准）\nsh 1 2 mysql -uroot -p111 -e 'use test;drop tables test1;show tables;' mysql -uroot -p111 test \u003c /2.sql 假设开发人员让我们插入数据到数据库（可能是邮件发给我们的，内容可能是字符串或是文件）sql文件里没有use db这样的字符，在导入时就要指定数据库名了。\nsql 1 2 3 4 5 6 7 $ mysql -uroot -p111 \u003c /data/3306/2.sql ERROR 1046 (3D000) at line 22: No database selected $ mysql -uroot -p111 -e'use test'; ERROR 1049 (42000) at line 1: Unknown database 'test' $ mysql -uroot -p111 test\u003c/data/3306/2.sql 如果在导出时指定-B参数，恢复时无需指定库恢复，为什么？\n因为-B参数带了use test;还会有create database test;，而恢复时指定库就类似与use test。\n如果mysqldump备份时指定了-B，则恢复可以用如下方法：\nsh 1 2 mysql -uroot -p111 \u003c back.sql mysql -uroot -p111 DbName \u003c back.sql$ 条件是dbname库必须存在 提示：此处DbName相当于use Dbname\n问题：分库分表备份的数据如何快速恢复呢？\n还是通过脚本读指定的库和表，调用mysql命令恢复\nsh 1 for name in `ls /back/*.sql|sed -r 's#.back.sq$#g'`;do mysql -uroot -p111 test\u003c${name}.back.sql; done; 针对压缩的备份数据恢复\n方法1：\nsh 1 2 3 4 gzip -d /back/mysql_back.sql.gz mysql -uroot -p111 dbname \u003c /back/mysql_back.sql gzip -cd mysql_back.sql.gz \u003e mysql.sql$←不删除源备份文件 方法2：\nsh 1 2 gunzip \u003c b.sql.gz \u003e /opt/mysql.sql mysql -uroot -p111 \u003c /opt/mysql.sql 或者\nsh 1 gunzip -c back.sql.gz|mysql -uroot -p111 test sh 1 2 3 4 mysql -uroot -p111 -e \\ 'SELECT CONCAT(\"drop table \",table_name,\";\") FROM information_schema.`TABLES` WHERE table_schema=\"test\";' \\ |grep -Ev 'CONCAT(\"drop table \",table_name,\";\")'|sed -r \"s#^(.*)#mysql -uroot -p111 -e 'use test;\\1'#g\" \\ |bash 分表分库备份脚本\nsh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/sh . /etc/init.d/functions # define variable BackDir=~/back User=root PassWD=111 Socket=/data/3306/mysql.sock # define comment Login=\"mysql -u${User} -p${PassWD} -S ${Socket}\" Dump=\"mysqldump -u${User} -p${PassWD} -S${Socket} -x --master-data=2 --compact\" DataBase=`$Login -e 'show databases;'|egrep -v '*chema|mysql'|sed '1d'` [ ! -d $BackDir ] \u0026\u0026 mkdir -p $BackDir for list in $DataBase do ST=`$Login -e \"use $list;show tables;\"|sed '1d'` [ ! -d $BackDir/$list ] \u0026\u0026 mkdir -p $BackDir/$list for table in $ST do $Dump $list $table|gzip\u003e$BackDir/$list/$table.`date +%F`.sql.gz [ $? -eq 0 ] \u0026\u0026 action \"$list \u003e $table is ok\" /bin/true || \"$list \u003e $table dump is fail\" done done ","wordCount":"1254","inLanguage":"zh","datePublished":"2017-05-14T00:00:00Z","dateModified":"2022-12-12T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2017/05/ch3-mysql-backup-and-restore/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">ch03 - MySQL的备份与恢复</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2017-05-14</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1254 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>6 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/databases/>#Databases</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%a4%87%e4%bb%bd%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e6%84%8f%e4%b9%89 aria-label=备份数据库的意义>备份数据库的意义</a><li><a href=#%e5%a4%87%e4%bb%bd%e5%8d%95%e4%b8%aa%e6%95%b0%e6%8d%ae%e5%ba%93%e7%bb%83%e4%b9%a0%e5%a4%9a%e7%a7%8d%e5%8f%82%e6%95%b0%e7%9a%84%e4%bd%bf%e7%94%a8 aria-label=备份单个数据库练习多种参数的使用>备份单个数据库练习多种参数的使用</a><ul><li><a href=#%e5%a4%87%e4%bb%bd%e5%ba%93 aria-label=备份库>备份库</a><li><a href=#%e8%ae%be%e7%bd%ae%e5%ad%97%e7%ac%a6%e9%9b%86%e5%8f%82%e6%95%b0%e5%a4%87%e4%bb%bd%e8%a7%a3%e5%86%b3%e4%b9%b1%e7%a0%81%e9%97%ae%e9%a2%98 aria-label=设置字符集参数备份解决乱码问题>设置字符集参数备份解决乱码问题</a><li><a href=#%e5%a4%87%e4%bb%bd%e6%97%b6%e5%8a%a0-b%e5%8f%82%e6%95%b0%e5%a2%9e%e5%8a%a0%e5%88%9b%e5%bb%ba%e5%ba%93%e4%b8%8e%e9%80%89%e6%8b%a9%e5%ba%93 aria-label=备份时加-B参数，增加创建库与选择库>备份时加<code>-B</code>参数，增加创建库与选择库</a><li><a href=#%e4%bc%98%e5%8c%96%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%a4%a7%e5%b0%8f%e5%87%8f%e5%b0%91%e8%be%93%e5%87%ba%e6%b3%a8%e9%87%8adebug%e8%b0%83%e8%af%95 aria-label=优化配置文件大小减少输出注释（debug调试）>优化配置文件大小减少输出注释（debug调试）</a><li><a href=#%e5%8e%8b%e7%bc%a9%e5%a4%87%e4%bb%bd%e7%9a%84%e6%95%b0%e6%8d%ae aria-label=压缩备份的数据>压缩备份的数据</a></ul><li><a href=#mysqldump%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 aria-label=mysqldump的工作原理>mysqldump的工作原理</a><li><a href=#%e5%88%86%e5%ba%93%e5%a4%87%e4%bb%bd aria-label=分库备份>分库备份</a><li><a href=#%e5%a4%87%e4%bb%bd%e5%8d%95%e4%b8%aa%e8%a1%a8 aria-label=备份单个表>备份单个表</a><li><a href=#%e5%a4%87%e4%bb%bd%e6%95%b0%e6%8d%ae%e8%a1%a8%e7%bb%93%e6%9e%84 aria-label=备份数据表结构>备份数据表结构</a><li><a href=#%e5%88%b7%e6%96%b0binlog%e5%8f%82%e6%95%b0 aria-label=刷新binlog参数>刷新binlog参数</a><ul><li><a href=#binlog%e4%bd%9c%e7%94%a8 aria-label=binlog作用>binlog作用</a><li><a href=#%e5%ae%9a%e7%95%8cbinlog aria-label=定界binlog>定界binlog</a></ul><li><a href=#mysqldump%e5%85%b3%e9%94%ae%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e aria-label=mysqldump关键参数说明>mysqldump关键参数说明</a><li><a href=#%e7%94%9f%e4%ba%a7%e5%9c%ba%e6%99%af%e4%b8%8d%e5%90%8c%e5%bc%95%e6%93%8emysqldump%e5%a4%87%e4%bb%bd%e5%91%bd%e4%bb%a4 aria-label=生产场景不同引擎mysqldump备份命令>生产场景不同引擎mysqldump备份命令</a><ul><li><a href=#myisam%e5%bc%95%e6%93%8e%e4%bc%81%e4%b8%9a%e7%94%9f%e4%ba%a7%e5%a4%87%e4%bb%bd%e5%91%bd%e4%bb%a4%e9%80%82%e5%90%88%e6%89%80%e6%9c%89%e5%bc%95%e6%93%8e%e6%88%96%e6%b7%b7%e5%90%88%e5%bc%95%e6%93%8e aria-label=myisam引擎企业生产备份，命令（适合所有引擎或混合引擎）：>myisam引擎企业生产备份，命令（适合所有引擎或混合引擎）：</a><li><a href=#innodb%e5%bc%95%e6%93%8e%e4%bc%81%e4%b8%9a%e7%94%9f%e4%ba%a7%e5%a4%87%e4%bb%bd%e5%91%bd%e4%bb%a4%e6%8e%a8%e8%8d%90%e4%bd%bf%e7%94%a8 aria-label=innodb引擎企业生产备份命令：推荐使用>innodb引擎企业生产备份命令：推荐使用</a><li><a href=#--master-data%e4%bd%9c%e7%94%a8 aria-label=&amp;ndash;master-data作用：>&ndash;master-data作用：</a></ul><li><a href=#%e6%81%a2%e5%a4%8d%e6%95%b0%e6%8d%ae%e5%ba%93%e5%ae%9e%e6%88%98 aria-label=恢复数据库实战>恢复数据库实战</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h3 id=备份数据库的意义>备份数据库的意义<a hidden class=anchor aria-hidden=true href=#备份数据库的意义>#</a></h3><p>运维工作到底是什么工作，到底是做什么？</p><p>运维工作简单的概括就两件事：</p><p>一是保护公司的数据；二是网站7*24小时提供服务。</p><p>那么对数据丢失一部分和网站7*24小时提供服务那个更重要呢？</p><p>都很重要，只是说相比哪个更为重要？这个具体要看业务个公司。例如：银行、金融行业，数据是最重要的，一条都不能丢，可能宕机停机影响就没那么大。百度搜索，腾讯qq聊天记录丢失了几万条数据，都不算啥。</p><p>对于数据来讲，数据最核心的就是数据库数据。</p><h3 id=备份单个数据库练习多种参数的使用>备份单个数据库练习多种参数的使用<a hidden class=anchor aria-hidden=true href=#备份单个数据库练习多种参数的使用>#</a></h3><p>MySQL数据库自带了一个很好用的备份命令，就是mysqldump，它的基本使用如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>u</span><span class=w> </span><span class=n>UserName</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>PassWord</span><span class=w> </span><span class=n>dbName</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>backName</span><span class=p>.</span><span class=k>sql</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=备份库>备份库<a hidden class=anchor aria-hidden=true href=#备份库>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p</span><span class=w> </span><span class=n>test</span><span class=o>&gt;</span><span class=n>mysql</span><span class=p>.</span><span class=k>sql</span><span class=w>   </span></span></span></code></pre></td></tr></table></div></div></div></div><p>检查备份结果</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>$</span><span class=w> </span><span class=n>egrep</span><span class=w> </span><span class=o>-</span><span class=n>v</span><span class=w>  </span><span class=s2>&#34;#|\*|--|^$&#34;</span><span class=w> </span><span class=p>.</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=k>sql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>test1</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>test1</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num1</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num2</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num3</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num4</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;test1&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=o>=</span><span class=mi>2000001</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LOCK</span><span class=w> </span><span class=n>TABLES</span><span class=w> </span><span class=o>`</span><span class=n>test1</span><span class=o>`</span><span class=w> </span><span class=k>WRITE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>test1</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=s1>&#39;1455577&#39;</span><span class=p>,</span><span class=s1>&#39;9779520&#39;</span><span class=p>,</span><span class=s1>&#39;4530868&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span></span></span></code></pre></td></tr></table></div></div></div></div><hr><p><font color=#0215cd size=2>注：因为导出时的格式没有加字符集，一般恢复到数据库里会正常，只是系统外查看不正常而已。另外，insert是批量插入的方式，这样在恢复时效率很高。</font></p><hr><p>根据查看的结果，我们看到了已备份的表结构语句及插入的数据整合的sql语句，但是中文数据乱码了。</p><h4 id=设置字符集参数备份解决乱码问题>设置字符集参数备份解决乱码问题<a hidden class=anchor aria-hidden=true href=#设置字符集参数备份解决乱码问题>#</a></h4><p>查看备份前数据库客户端及服务器端的字符集设置</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s2>&#34;character%&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+-----------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Variable_name</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=n>Value</span><span class=w>                     		</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+-----------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>character_set_client</span><span class=w>   	</span><span class=o>|</span><span class=w> </span><span class=n>utf8</span><span class=w>                              </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>character_set_connection</span><span class=w>	</span><span class=o>|</span><span class=w> </span><span class=n>utf8</span><span class=w>                            	</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>character_set_database</span><span class=w>   	</span><span class=o>|</span><span class=w> </span><span class=n>utf8</span><span class=w>                            	</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>character_set_filesystem</span><span class=w>	</span><span class=o>|</span><span class=w> </span><span class=nb>binary</span><span class=w>                          	</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>character_set_results</span><span class=w>    	</span><span class=o>|</span><span class=w> </span><span class=n>utf8</span><span class=w>                            	</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>character_set_server</span><span class=w>     	</span><span class=o>|</span><span class=w> </span><span class=n>utf8</span><span class=w>                            	</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>character_set_system</span><span class=w>     	</span><span class=o>|</span><span class=w> </span><span class=n>utf8</span><span class=w>                            	</span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>character_sets_dir</span><span class=w>       	</span><span class=o>|</span><span class=w> </span><span class=o>/</span><span class=n>app</span><span class=o>/</span><span class=n>mysql</span><span class=o>-</span><span class=mi>5</span><span class=p>.</span><span class=mi>5</span><span class=p>.</span><span class=mi>54</span><span class=o>/</span><span class=k>share</span><span class=o>/</span><span class=n>charsets</span><span class=o>/</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------------------------+-----------------------------------+</span></span></span></code></pre></td></tr></table></div></div></div></div><p>指定对应的字符集备份，这里为<font color=#f8070d size=3><code>--default-character-set=utf8</code></font></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>text</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>mysqldump -uroot -p111 --default-character-set=utf8 t1 &gt; t.sql -S /data/3306/mysql.sock</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=备份时加-b参数增加创建库与选择库>备份时加<code>-B</code>参数，增加创建库与选择库<a hidden class=anchor aria-hidden=true href=#备份时加-b参数增加创建库与选择库>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w> </span><span class=c1>-- Current Database: `t1`
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=cm>/*!32312 IF NOT EXISTS*/</span><span class=w> </span><span class=o>`</span><span class=n>t1</span><span class=o>`</span><span class=w> </span><span class=cm>/*!40100|  
</span></span></span><span class=line><span class=cl><span class=cm> USE `t1`;</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=优化配置文件大小减少输出注释debug调试>优化配置文件大小减少输出注释（debug调试）<a hidden class=anchor aria-hidden=true href=#优化配置文件大小减少输出注释debug调试>#</a></h4><p>利用<font color=#f8070d size=3><code>mysqldump</code></font>的<font color=#f8070d size=3><code>--compact</code></font>参数优化下备份结果</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mysqldump -uroot -p111 --default-character-set<span class=o>=</span>utf8 --compact -B t1 &gt; t_b.sql
</span></span><span class=line><span class=cl>$ cat t_b.sql </span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=cm>/*!32312 IF NOT EXISTS*/</span><span class=w> </span><span class=o>`</span><span class=n>t1</span><span class=o>`</span><span class=w> </span><span class=cm>/*!40100 DEFAULT CHARACTER SET utf8 */</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>USE</span><span class=w> </span><span class=o>`</span><span class=n>t1</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/*!40101 SET character_set_client = utf8 */</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>test1</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=n>unsigned</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num1</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num2</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num3</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>num4</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;test1&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=o>=</span><span class=mi>2000031</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/*!40101 SET character_set_client = @saved_cs_client */</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>test1</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>2000001</span><span class=p>,</span><span class=s1>&#39;690938&#39;</span><span class=p>,</span><span class=s1>&#39;794482&#39;</span><span class=p>,</span><span class=s1>&#39;1899596&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000002</span><span class=p>,</span><span class=s1>&#39;7114536&#39;</span><span class=p>,</span><span class=s1>&#39;9873892&#39;</span><span class=p>,</span><span class=s1>&#39;8025852&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000003</span><span class=p>,</span><span class=s1>&#39;507584&#39;</span><span class=p>,</span><span class=s1>&#39;8460367&#39;</span><span class=p>,</span><span class=s1>&#39;779079&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000004</span><span class=p>,</span><span class=s1>&#39;8514298&#39;</span><span class=p>,</span><span class=s1>&#39;234250&#39;</span><span class=p>,</span><span class=s1>&#39;5628359&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000005</span><span class=p>,</span><span class=s1>&#39;7439042&#39;</span><span class=p>,</span><span class=s1>&#39;310137&#39;</span><span class=p>,</span><span class=s1>&#39;9233557&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000006</span><span class=p>,</span><span class=s1>&#39;5237373&#39;</span><span class=p>,</span><span class=s1>&#39;8486196&#39;</span><span class=p>,</span><span class=s1>&#39;6718861&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000007</span><span class=p>,</span><span class=s1>&#39;8135719&#39;</span><span class=p>,</span><span class=s1>&#39;522012&#39;</span><span class=p>,</span><span class=s1>&#39;8202901&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000008</span><span class=p>,</span><span class=s1>&#39;9448472&#39;</span><span class=p>,</span><span class=s1>&#39;2633656&#39;</span><span class=p>,</span><span class=s1>&#39;4822864&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000009</span><span class=p>,</span><span class=s1>&#39;6213355&#39;</span><span class=p>,</span><span class=s1>&#39;6598180&#39;</span><span class=p>,</span><span class=s1>&#39;4350835&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000010</span><span class=p>,</span><span class=s1>&#39;1959635&#39;</span><span class=p>,</span><span class=s1>&#39;6745673&#39;</span><span class=p>,</span><span class=s1>&#39;7849459&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000011</span><span class=p>,</span><span class=s1>&#39;9010275&#39;</span><span class=p>,</span><span class=s1>&#39;1503001&#39;</span><span class=p>,</span><span class=s1>&#39;484179&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000012</span><span class=p>,</span><span class=s1>&#39;7911894&#39;</span><span class=p>,</span><span class=s1>&#39;8106930&#39;</span><span class=p>,</span><span class=s1>&#39;6798971&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000013</span><span class=p>,</span><span class=s1>&#39;9674065&#39;</span><span class=p>,</span><span class=s1>&#39;7973412&#39;</span><span class=p>,</span><span class=s1>&#39;844865&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000014</span><span class=p>,</span><span class=s1>&#39;304088&#39;</span><span class=p>,</span><span class=s1>&#39;8985848&#39;</span><span class=p>,</span><span class=s1>&#39;4016974&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000015</span><span class=p>,</span><span class=s1>&#39;3127327&#39;</span><span class=p>,</span><span class=s1>&#39;3585711&#39;</span><span class=p>,</span><span class=s1>&#39;8546578&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000016</span><span class=p>,</span><span class=s1>&#39;1975754&#39;</span><span class=p>,</span><span class=s1>&#39;4239037&#39;</span><span class=p>,</span><span class=s1>&#39;5267926&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000017</span><span class=p>,</span><span class=s1>&#39;3622517&#39;</span><span class=p>,</span><span class=s1>&#39;2308806&#39;</span><span class=p>,</span><span class=s1>&#39;676480&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000018</span><span class=p>,</span><span class=s1>&#39;6455983&#39;</span><span class=p>,</span><span class=s1>&#39;250474&#39;</span><span class=p>,</span><span class=s1>&#39;1884422&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000019</span><span class=p>,</span><span class=s1>&#39;8670686&#39;</span><span class=p>,</span><span class=s1>&#39;7700168&#39;</span><span class=p>,</span><span class=s1>&#39;2488781&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000020</span><span class=p>,</span><span class=s1>&#39;9343400&#39;</span><span class=p>,</span><span class=s1>&#39;9250657&#39;</span><span class=p>,</span><span class=s1>&#39;8223086&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000021</span><span class=p>,</span><span class=s1>&#39;3363461&#39;</span><span class=p>,</span><span class=s1>&#39;2148048&#39;</span><span class=p>,</span><span class=s1>&#39;649856&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000022</span><span class=p>,</span><span class=s1>&#39;6805137&#39;</span><span class=p>,</span><span class=s1>&#39;2076115&#39;</span><span class=p>,</span><span class=s1>&#39;9965166&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000023</span><span class=p>,</span><span class=s1>&#39;3597485&#39;</span><span class=p>,</span><span class=s1>&#39;8091927&#39;</span><span class=p>,</span><span class=s1>&#39;9667180&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000024</span><span class=p>,</span><span class=s1>&#39;4060121&#39;</span><span class=p>,</span><span class=s1>&#39;1299065&#39;</span><span class=p>,</span><span class=s1>&#39;4314962&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000025</span><span class=p>,</span><span class=s1>&#39;7677614&#39;</span><span class=p>,</span><span class=s1>&#39;5443186&#39;</span><span class=p>,</span><span class=s1>&#39;4183087&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000026</span><span class=p>,</span><span class=s1>&#39;4585879&#39;</span><span class=p>,</span><span class=s1>&#39;380131&#39;</span><span class=p>,</span><span class=s1>&#39;8143022&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000027</span><span class=p>,</span><span class=s1>&#39;9574716&#39;</span><span class=p>,</span><span class=s1>&#39;3444513&#39;</span><span class=p>,</span><span class=s1>&#39;8498418&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000028</span><span class=p>,</span><span class=s1>&#39;2158552&#39;</span><span class=p>,</span><span class=s1>&#39;5297508&#39;</span><span class=p>,</span><span class=s1>&#39;11882&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000029</span><span class=p>,</span><span class=s1>&#39;4166888&#39;</span><span class=p>,</span><span class=s1>&#39;798795&#39;</span><span class=p>,</span><span class=s1>&#39;1493311&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>),(</span><span class=mi>2000030</span><span class=p>,</span><span class=s1>&#39;5070170&#39;</span><span class=p>,</span><span class=s1>&#39;870919&#39;</span><span class=p>,</span><span class=s1>&#39;9144083&#39;</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>&ndash;compact参数说明</strong>：</p></blockquote><p>（测试时用的比较多）可以优化输出内容的大小，让容量更少，适合调试。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--compact		Give less verbose output (useful for debugging).		Disables
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> 			</span><span class=k>structure</span><span class=w> </span><span class=n>comments</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>header</span><span class=o>/</span><span class=n>footer</span><span class=w> </span><span class=n>contructs</span><span class=p>.</span><span class=w> 	</span><span class=n>Enables</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>options</span><span class=w>  </span><span class=c1>--skip-add-drop-table --no-set-names
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> 	 </span><span class=c1>--skip-disable-keys --skip-add-locks</span></span></span></code></pre></td></tr></table></div></div></div></div><p>参数说明：该选项使得输出内容更简介，不包括默认选项中各种注释。有如下几个参数的功能。</p><p><font color=#f8070d size=3><code>--skip-add-drop-table</code></font></p><p><font color=#f8070d size=3><code>--no-set-names</code></font></p><p><font color=#f8070d size=3><code>--skip-disable-keys</code></font></p><p><font color=#f8070d size=3><code>--skip-add-locks</code></font></p><h4 id=压缩备份的数据>压缩备份的数据<a hidden class=anchor aria-hidden=true href=#压缩备份的数据>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--- 输出时用管道进行备份，压缩效率将近3倍
</span></span></span><span class=line><span class=cl><span class=c1>--- 这个保存为一个压缩文件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>B</span><span class=w> </span><span class=n>t1</span><span class=o>|</span><span class=n>gzip</span><span class=w> </span><span class=o>&gt;</span><span class=n>t1</span><span class=p>.</span><span class=k>sql</span><span class=p>.</span><span class=n>gz</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1360</span><span class=w>  </span><span class=n>t1</span><span class=p>.</span><span class=k>sql</span><span class=p>.</span><span class=k>g</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3365</span><span class=w>  </span><span class=n>t2</span><span class=p>.</span><span class=k>sql</span></span></span></code></pre></td></tr></table></div></div></div></div><p>小结：</p><ol><li>备份数据使用-B参数，会在备份数据中增加建库及use库的语句</li><li>备份数据使用-B参数，后面可以直接接多个库名。</li><li>共gzip对备份的数据亚索</li><li>debug时可以用&ndash;compact减少输出，但不用于生产</li><li>指定字符集备份用&ndash;default-character-set=utf8（一般不用）</li></ol><h3 id=mysqldump的工作原理>mysqldump的工作原理<a hidden class=anchor aria-hidden=true href=#mysqldump的工作原理>#</a></h3><p>利用mysqldump命令备份数据的过程，实际上就是把数据从mysql库里以逻辑的sql语句的形式直接输出或者生成备份的文件的过程。</p><p>提示：使用mysqldump是把数据库的数据导出通过sql语句的形式存储，这种备份方式称之为逻辑备份，效率不是很高，一般50G以内的数据。</p><p>其他备份方式：物理备份：cp tar（停库），xtrabackup物理热备份。
备份多个库及多个参数</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=c1>--compact \
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>-</span><span class=n>B</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=n>t1</span><span class=o>|</span><span class=n>gzip</span><span class=o>&gt;/</span><span class=k>data</span><span class=o>/</span><span class=n>test1</span><span class=p>.</span><span class=k>sql</span></span></span></code></pre></td></tr></table></div></div></div></div><p><strong>-B参数说明</strong></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-B，参数是关键，表示接多个库并且增加use db和create database db的信息
</span></span><span class=line><span class=cl>-B, --databases     Dump several databases. Note the difference in usage<span class=p>;</span> in
</span></span><span class=line><span class=cl>                      this <span class=k>case</span> no tables are given. All name arguments are
</span></span><span class=line><span class=cl>                      regarded as database names. <span class=s1>&#39;USE db_name;&#39;</span> will be
</span></span><span class=line><span class=cl>                      included in the output.
</span></span><span class=line><span class=cl>                      
</span></span><span class=line><span class=cl><span class=c1># 用于导出多个数据库，注意这种情况系没有表。所有的名称参数都被认作为是数据库。</span>
</span></span><span class=line><span class=cl><span class=c1># 每个数据库名以空格隔开，将使用的数据库名称包含到输出里</span>
</span></span><span class=line><span class=cl><span class=c1># 当-B后的数据库列全时，同-A参数。</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=分库备份>分库备份<a hidden class=anchor aria-hidden=true href=#分库备份>#</a></h3><p>分库备份实际上就是执行一个备份语句备份一个库，如果数据库里有多个库，就执行多条相同的备份单个库的备份语句就可以备份多个库了，注意每个库都可以用对应备份的库作为库名，结尾加.sql。备份多个库的命令如下：</p><p>mysqldump -uroot -p111 -B oldboy;</p><p>mysqldump -uroot -p111 -B test;</p><p>&mldr;.</p><p>&mldr;.</p><blockquote><p><strong>分库备份法1</strong>：</p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>-</span><span class=n>e</span><span class=w> </span><span class=s1>&#39;show databases;&#39;</span><span class=o>|</span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>egrep</span><span class=w> </span><span class=o>-</span><span class=n>v</span><span class=w> </span><span class=s2>&#34;Database|_schema|mysql&#34;</span><span class=o>|</span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sed</span><span class=w> </span><span class=o>-</span><span class=n>r</span><span class=w> </span><span class=s1>&#39;s#^(.*)#mysqldump -uroot -p111 -S /data/3306/mysql.sock \1#g&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=n>bingbing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=n>t1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=n>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 将结果交给bash
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>-</span><span class=n>e</span><span class=w> </span><span class=s1>&#39;show databases;&#39;</span><span class=o>|</span><span class=n>egrep</span><span class=w> </span><span class=o>-</span><span class=n>v</span><span class=w> </span><span class=s2>&#34;Database|_schema|mysql&#34;</span><span class=o>|</span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sed</span><span class=w> </span><span class=o>-</span><span class=n>r</span><span class=w> </span><span class=s1>&#39;s#^(.*)#mysqldump -uroot -p111 -S /data/3306/mysql.sock -B \1|gzip&gt;\1.sql.gz#g&#39;</span><span class=w> </span><span class=err>\</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=n>bash</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p>法2：</p></blockquote><p>见分库分表备份视频：http://edu.51cto.com/course/course_id-808.html</p><blockquote><p><strong>分库备份的意义何在？</strong></p></blockquote><p>有时一个企业的数据库里会有多个库，例如（www.bbs，blog），但是出问题的时候很可能是某一个库，如果在备份时把所有的库都备份成了一个数据文件的话，回复某一个库的数据是就比较麻烦了。</p><h3 id=备份单个表>备份单个表<a hidden class=anchor aria-hidden=true href=#备份单个表>#</a></h3><p>语法：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysqldump -uuserName -ppassWord dbName tableName &gt;/data.sql
</span></span><span class=line><span class=cl>mysqldump -uuserName -ppassWord dbName tableName1 tableName2.. &gt;/data.sql</span></span></code></pre></td></tr></table></div></div></div></div><hr><p><strong><font color=#0215cd size=2>提示：不能加<font color=#f8070d size=3><code>-B</code></font>参数了，因为库后面就是表了。</font></strong></p><hr><p>企业需求：一个库里有大表有小标，有时可能需要只回复某一个小表，上述的多表备份很难拆开，就想没有分库那样导致恢复某一个小表很麻烦。</p><p>那么又如何进行分表备份呢？如下，和分库的思想一样，每执行一条语句备份一个表，生成不同的数据文件即可。如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql -uroot -p111 -e <span class=s1>&#39;use test; show tables;&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=p>|</span>egrep -v <span class=s1>&#39;Tables_in_test&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=p>|</span>sed -r <span class=s1>&#39;s#^(.*)#mysqldump -uroot -p111 --compact test \1&gt;\1.sq$g&#39;</span><span class=p>|</span>bash</span></span></code></pre></td></tr></table></div></div></div></div><p><font color=#f8070d size=2>分表备份缺点：文件多，很碎</font></p><pre><code>  备一个完整全备，在做一个分库分表备份
  脚本批量备份恢复多个SQL文件
</code></pre><blockquote><p><strong>面试题：多个库或者多个表备份到一块了，如何恢复单个库或者表？</strong></p></blockquote><p>解答：</p><ol><li>第三方测试库，导入到库里，然后把需要的备份出来，恢复到正式库里。</li><li>单表：grep表名 bak.sql>tab_name。</li><li>实现分库分表备份</li></ol><h3 id=备份数据表结构>备份数据表结构<a hidden class=anchor aria-hidden=true href=#备份数据表结构>#</a></h3><p>利用<font color=#f8070d size=2><code>mysqldump -d</code></font>参数只备份表的结构，例：备份oldboy库的所有表的结构</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>d</span><span class=w> </span><span class=c1>--compact -B test &gt; t.sql</span></span></span></code></pre></td></tr></table></div></div></div></div><p>如果只导出数据则用<font color=#f8070d size=2><code>-t</code></font></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=o>-</span><span class=n>t</span><span class=w> </span><span class=c1>--compact -B test &gt; 1t.sql </span></span></span></code></pre></td></tr></table></div></div></div></div><p><font color=#f8070d size=2><code>-T --tab=path</code></font>：语句与数据分离，数据为文本。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>S</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=n>mysql</span><span class=p>.</span><span class=n>sock</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=n>test1</span><span class=w> </span><span class=o>-</span><span class=n>T</span><span class=w> </span><span class=o>/</span><span class=k>data</span></span></span></code></pre></td></tr></table></div></div></div></div><p>注意只能对表进行分离，对数据库进行分离提示如下：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mysqldump -uroot -p111 -S /data/3306/mysql.sock -B t1 -T /data         
</span></span><span class=line><span class=cl>mysqldump: --databases or --all-databases can<span class=err>&#39;</span>t be used with --tab.</span></span></code></pre></td></tr></table></div></div></div></div><p>小结：</p><ul><li><font color=#f8070d size=3><code>-B</code></font>备份多个库（并添加create和use语句）</li><li><font color=#f8070d size=3><code>-d</code></font>只备份库表结构</li><li><font color=#f8070d size=3><code>-t</code></font>只备份数据（sql语句形式）</li><li><font color=#f8070d size=3><code>-T</code></font>分离表和数据成不同的文件，数据是文本，非SQL语句</li></ul><h3 id=刷新binlog参数>刷新binlog参数<a hidden class=anchor aria-hidden=true href=#刷新binlog参数>#</a></h3><p>mysqldump用于定时对某一时刻的数据的全备份，例如：00点进行备份bak.sql.gz</p><p>增量备份：当有数据写入到数据库时，还会同时把更新的SQL语句写入到对应的文件里，这个文件就叫做binlog。</p><p>比如说晚上0点做备份， 10点宕机了，0-10点的数据就丢失了</p><p><strong>10点前丢失数据需要恢复的数据</strong>：</p><ol><li>00点时刻备份的bak.sql.gz数据还原到数据库，这个时候数据恢复到了00点</li><li>00-10点数据，就要从binlog里恢复。</li></ol><h4 id=binlog作用>binlog作用<a hidden class=anchor aria-hidden=true href=#binlog作用>#</a></h4><p>记录数据库更新的sql语句，不记录show select等，只是记录对数据库记录变更的二进制文件。</p><p>在mysql数据库当中，当你做一个全备之后到出问题的时刻，要想恢复，就是全备+全备之后的所有binlog。</p><h4 id=定界binlog>定界binlog<a hidden class=anchor aria-hidden=true href=#定界binlog>#</a></h4><p><strong>问题：怎么界定备份之后和binlog文件之间连接的很紧密不多也不少。</strong></p><p>通过文件的日志点。可以通过<font color=#f8070d size=3><code>-F</code></font>做一个区分。</p><p>只要我们做了备份，然后就刷新binlog，将来恢复的就是130以下的。130以上的包里面就包含了
binlog日志切割：确定全备和增量的结界点-F刷新binlog日志，生成新日志文件，将来增量恢复从这个新日志文件开始。</p><p>binglog文件生效需要一个参数：<font color=#f8070d size=3><code>log-bin log-bin=/data/3306/mysql-bin</code></font></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ll <span class=c1># ←备份前，查看目录binlog文件</span>
</span></span><span class=line><span class=cl>mysql-bin.000316
</span></span><span class=line><span class=cl>mysql-bin.000317
</span></span><span class=line><span class=cl>mysql-bin.index
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mysqldump -uroot -p111 -S /data/3306/mysql.sock --compact -B t1 &gt; t1.sql -F
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ll <span class=c1>#←在刷新之后可以看到binlog文件增加了</span>
</span></span><span class=line><span class=cl>mysql-bin.000316
</span></span><span class=line><span class=cl>mysql-bin.000317
</span></span><span class=line><span class=cl>mysql-bin.000318
</span></span><span class=line><span class=cl>mysql-bin.index</span></span></code></pre></td></tr></table></div></div></div></div><p><font color=#f8070d size=2><code>--master-data</code></font> 在备份语句里添加 <font color=#f8070d size=3><code>CHANGE MASTER</code></font> 语句及 <font color=#f8070d size=3><code>binlog</code></font> 文件及位置点信息</p><p>  值1，为可执行的CHANGE MASTER语句</p><p>  值2，为注释的<code>--CHANGE MASTER</code>语句</p><hr><p><font color=#0215cd size=3>注：--master-data除了增量恢复确定临界点外，做主从复制时作用更大</font></p><hr><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 不加--master-data语句</span>
</span></span><span class=line><span class=cl>mysqldump -uroot -p111 --compact -B t1 &gt; t1.sql
</span></span><span class=line><span class=cl>cat t1.sql 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CREATE DATABASE /*!32312 IF NOT EXISTS*/ <span class=sb>`</span>t1<span class=sb>`</span> /*!40100 DEFAULT CHARACTER SET utf8 */<span class=p>;</span></span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 加上master-data语句后
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>mysqldump</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=c1>--compact -B t1 &gt; t1.sql --master-data=1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>cat</span><span class=w> </span><span class=n>t1</span><span class=p>.</span><span class=k>sql</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>CHANGE</span><span class=w> </span><span class=n>MASTER</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=n>MASTER_LOG_FILE</span><span class=o>=</span><span class=s1>&#39;mysql-bin.000318&#39;</span><span class=p>,</span><span class=w> </span><span class=n>MASTER_LOG_POS</span><span class=o>=</span><span class=mi>107</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=cm>/*!32312 IF NOT EXISTS*/</span><span class=w> </span><span class=o>`</span><span class=n>t1</span><span class=o>`</span><span class=w> </span><span class=cm>/*!40100 DEFAULT CHARACTER SET utf8 */</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mysqldump -uroot -p111 --compact -B t1 &gt; t1.sql --master-data<span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl>$ cat t1.sql </span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- CHANGE MASTER TO MASTER_LOG_FILE=&#39;mysql-bin.000318&#39;, MASTER_LOG_POS=107;</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=mysqldump关键参数说明>mysqldump关键参数说明<a hidden class=anchor aria-hidden=true href=#mysqldump关键参数说明>#</a></h3><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-B</td><td>指定多个库，增加建库语句和use语句。</td></tr><tr><td>&ndash;compact</td><td>去掉注释，适合调试输出，生产不适用</td></tr><tr><td>-A</td><td>备份所有库</td></tr><tr><td>-F</td><td>刷新binlog日志，生成新文件，将来增量恢复从这个文件开始。</td></tr><tr><td>&ndash;master-data</td><td>增加binlog日志文件名及对应的位置点（即CHANGE MASTER语句）。&ndash;mater-data=1不注释 2注释</td></tr><tr><td>-x &ndash;lock-all-tables</td><td></td></tr><tr><td>-l &ndash;lock-tables</td><td>lock all tables for read</td></tr><tr><td>-d</td><td>只备份数据，无表结构，SQL语句形式。</td></tr><tr><td>-t</td><td>只备份数据，无库表结构，SQL语句形式。</td></tr><tr><td>-T</td><td>库表和数据分离不同文件，数据是文本形式。</td></tr><tr><td>&ndash;single-transaction</td><td>适合innodb事务数据库备份</td></tr><tr><td>-q --quick don&rsquo;t bufferquery</td><td>dump directly to stdout (Defaults to on; use &ndash;skip-quick to disable)</td></tr></tbody></table><hr><p><strong><font color=#0215cd size=2>说明：innodb表在备份时，通常启用选线&ndash;single-transaction来保证备份的一致性，实际上它的工作原理是设定本次会话的隔离级别为REPEATABLE READ，确保本次会话（dump）时，不会看到其他会话已经提交了的数据。</font></strong></p><hr><h3 id=生产场景不同引擎mysqldump备份命令>生产场景不同引擎mysqldump备份命令<a hidden class=anchor aria-hidden=true href=#生产场景不同引擎mysqldump备份命令>#</a></h3><h4 id=myisam引擎企业生产备份命令适合所有引擎或混合引擎>myisam引擎企业生产备份，命令（适合所有引擎或混合引擎）：<a hidden class=anchor aria-hidden=true href=#myisam引擎企业生产备份命令适合所有引擎或混合引擎>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mysqldump -uroot -p111 -A -B -F -R --master-data<span class=o>=</span><span class=m>2</span> -x --events<span class=p>|</span>gzip &gt; /data/all.sql.gz</span></span></code></pre></td></tr></table></div></div></div></div><p>提示：-F也可以不用，与&ndash;，master-data有写重复</p><h4 id=innodb引擎企业生产备份命令推荐使用>innodb引擎企业生产备份命令：推荐使用<a hidden class=anchor aria-hidden=true href=#innodb引擎企业生产备份命令推荐使用>#</a></h4><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mysqldump -uroot -p111 -A -B -F -R --master-data<span class=o>=</span><span class=m>2</span> --events --single-transaction<span class=p>|</span>gzip &gt;/data/all.sql.gz</span></span></code></pre></td></tr></table></div></div></div></div><h4 id=--master-data作用>&ndash;master-data作用：<a hidden class=anchor aria-hidden=true href=#--master-data作用>#</a></h4><ol><li>使用&ndash;master-data=2进行备份文件会增加如下内容：适合普通备份增量恢复</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>--CHANGE MASTER TO <span class=nv>MASTER_LOG_FILE</span><span class=o>=</span><span class=s1>&#39;mysql-bin.00020&#39;</span>, <span class=nv>MASTER_LOGZ_POS</span><span class=o>=</span><span class=m>1191</span></span></span></code></pre></td></tr></table></div></div></div></div><ol start=2><li>使用&ndash;maste-data=1进行备份文件会增加如下内容：更适合主从复制</li></ol><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>CHANGE MASTER TO <span class=nv>MASTER_LOG_FILE</span><span class=o>=</span><span class=s1>&#39;mysql-bin.00020&#39;</span>, <span class=nv>MASTER_LOGZ_POS</span><span class=o>=</span><span class=m>1191</span></span></span></code></pre></td></tr></table></div></div></div></div><p>锁表的原理：<div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/wps1.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/wps1.png#center alt=img onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>innodb有acid的特性</p><p>dump命令是看不到后面生成的数据，只能看到执行这个命令时所有数据之前的这个数据</p><p>事务引擎不锁表备份原理：&ndash;single-transaction 会话隔离</p><p>额外补充：</p><ol><li>mysqldump逻辑备份说明</li></ol><p>缺点：效率不是特别高</p><p>优点：简单、方便、可靠、迁移。</p><ol start=2><li>超过50G可选方案</li></ol><p>恢复数据到数据库的时候，认为通过SQL语句将数据删除的时候，做主从复制的时候</p><h3 id=恢复数据库实战>恢复数据库实战<a hidden class=anchor aria-hidden=true href=#恢复数据库实战>#</a></h3><p>数据库恢复事项</p><ol><li>数据恢复和字符集关联很大，如果字符集不正确会导致恢复的数据乱码。</li></ol><p>mysql命令以及source命令恢复数据可的原理就是把文件的SQL语句，在数据库里重新执行过程。</p><ol start=2><li>利用source命令恢复数据库。</li></ol><p>进入mysql数据库控制台，mysql -uroot -p登陆后</p><p>use database;</p><p>然后使用source xx.sql，后面参数为脚本文件（如这里用到的sql）</p><p>source 2.sql 这个文件是系统路径，默认是登陆mysql前的系统路径</p><p>提示：</p><pre><code>  source数据恢复和字符集关联很大，如果字符集不正确会导致恢复的数据乱码。
  utf8数据库，那么恢复的文件格式需要为utf8无bom头。
</code></pre><blockquote><p><strong>利用mysql命令恢复（标准）</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mysql -uroot -p111 -e <span class=s1>&#39;use test;drop tables test1;show tables;&#39;</span>
</span></span><span class=line><span class=cl>mysql -uroot -p111 <span class=nb>test</span> &lt; /2.sql</span></span></code></pre></td></tr></table></div></div></div></div><p>假设开发人员让我们插入数据到数据库（可能是邮件发给我们的，内容可能是字符串或是文件）sql文件里没有use db这样的字符，在导入时就要指定数据库名了。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sql</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=err>$</span><span class=w> </span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=mi>2</span><span class=p>.</span><span class=k>sql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1046</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=n>D000</span><span class=p>)</span><span class=w> </span><span class=k>at</span><span class=w> </span><span class=n>line</span><span class=w> </span><span class=mi>22</span><span class=p>:</span><span class=w> </span><span class=k>No</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>selected</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$</span><span class=w> </span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=o>-</span><span class=n>e</span><span class=s1>&#39;use test&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1049</span><span class=w> </span><span class=p>(</span><span class=mi>42000</span><span class=p>)</span><span class=w> </span><span class=k>at</span><span class=w> </span><span class=n>line</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=k>Unknown</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;test&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>$</span><span class=w> </span><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w> </span><span class=o>-</span><span class=n>p111</span><span class=w> </span><span class=n>test</span><span class=o>&lt;/</span><span class=k>data</span><span class=o>/</span><span class=mi>3306</span><span class=o>/</span><span class=mi>2</span><span class=p>.</span><span class=k>sql</span></span></span></code></pre></td></tr></table></div></div></div></div><p>如果在导出时指定-B参数，恢复时无需指定库恢复，为什么？</p><p>因为-B参数带了<font color=#f8070d size=3><code>use test;</code></font>还会有<font color=#f8070d size=3><code>create database test;</code></font>，而恢复时指定库就类似与<font color=#f8070d size=3><code>use test</code></font>。</p><p>如果mysqldump备份时指定了-B，则恢复可以用如下方法：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mysql -uroot -p111 &lt; back.sql
</span></span><span class=line><span class=cl>mysql -uroot -p111 DbName &lt; back.sql$ 条件是dbname库必须存在</span></span></code></pre></td></tr></table></div></div></div></div><hr><p><font color=#0215cd size=3>提示：此处DbName相当于use Dbname</font></p><hr><blockquote><p><strong>问题：分库分表备份的数据如何快速恢复呢？</strong></p></blockquote><p>还是通过脚本读指定的库和表，调用mysql命令恢复</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=k>for</span> name in <span class=sb>`</span>ls /back/*.sql<span class=p>|</span>sed -r <span class=s1>&#39;s#.back.sq$#g&#39;</span><span class=sb>`</span><span class=p>;</span><span class=k>do</span> mysql -uroot -p111 test&lt;<span class=si>${</span><span class=nv>name</span><span class=si>}</span>.back.sql<span class=p>;</span> <span class=k>done</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>针对压缩的备份数据恢复</strong></p></blockquote><p><strong>方法1</strong>：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>gzip -d /back/mysql_back.sql.gz
</span></span><span class=line><span class=cl>mysql -uroot -p111 dbname &lt; /back/mysql_back.sql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>gzip -cd mysql_back.sql.gz &gt; mysql.sql$←不删除源备份文件</span></span></code></pre></td></tr></table></div></div></div></div><p><strong>方法2</strong>：</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>gunzip &lt; b.sql.gz &gt; /opt/mysql.sql
</span></span><span class=line><span class=cl>mysql -uroot -p111 &lt; /opt/mysql.sql</span></span></code></pre></td></tr></table></div></div></div></div><p>或者</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>gunzip -c back.sql.gz<span class=p>|</span>mysql -uroot -p111 test</span></span></code></pre></td></tr></table></div></div></div></div><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>mysql -uroot -p111 -e <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>&#39;SELECT CONCAT(&#34;drop table &#34;,table_name,&#34;;&#34;) FROM information_schema.`TABLES` WHERE table_schema=&#34;test&#34;;&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=p>|</span>grep -Ev <span class=s1>&#39;CONCAT(&#34;drop table &#34;,table_name,&#34;;&#34;)&#39;</span><span class=p>|</span>sed -r <span class=s2>&#34;s#^(.*)#mysql -uroot -p111 -e &#39;use test;\1&#39;#g&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=p>|</span>bash</span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>分表分库备份脚本</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>. /etc/init.d/functions
</span></span><span class=line><span class=cl><span class=c1># define variable</span>
</span></span><span class=line><span class=cl><span class=nv>BackDir</span><span class=o>=</span>~/back
</span></span><span class=line><span class=cl><span class=nv>User</span><span class=o>=</span>root
</span></span><span class=line><span class=cl><span class=nv>PassWD</span><span class=o>=</span><span class=m>111</span>
</span></span><span class=line><span class=cl><span class=nv>Socket</span><span class=o>=</span>/data/3306/mysql.sock
</span></span><span class=line><span class=cl><span class=c1># define comment</span>
</span></span><span class=line><span class=cl><span class=nv>Login</span><span class=o>=</span><span class=s2>&#34;mysql -u</span><span class=si>${</span><span class=nv>User</span><span class=si>}</span><span class=s2> -p</span><span class=si>${</span><span class=nv>PassWD</span><span class=si>}</span><span class=s2> -S </span><span class=si>${</span><span class=nv>Socket</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>Dump</span><span class=o>=</span><span class=s2>&#34;mysqldump -u</span><span class=si>${</span><span class=nv>User</span><span class=si>}</span><span class=s2> -p</span><span class=si>${</span><span class=nv>PassWD</span><span class=si>}</span><span class=s2> -S</span><span class=si>${</span><span class=nv>Socket</span><span class=si>}</span><span class=s2> -x --master-data=2 --compact&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DataBase</span><span class=o>=</span><span class=sb>`</span><span class=nv>$Login</span> -e <span class=s1>&#39;show databases;&#39;</span><span class=p>|</span>egrep -v  <span class=s1>&#39;*chema|mysql&#39;</span><span class=p>|</span>sed <span class=s1>&#39;1d&#39;</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span> ! -d <span class=nv>$BackDir</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> mkdir -p <span class=nv>$BackDir</span>
</span></span><span class=line><span class=cl><span class=k>for</span> list in <span class=nv>$DataBase</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>	<span class=nv>ST</span><span class=o>=</span><span class=sb>`</span><span class=nv>$Login</span> -e <span class=s2>&#34;use </span><span class=nv>$list</span><span class=s2>;show tables;&#34;</span><span class=p>|</span>sed <span class=s1>&#39;1d&#39;</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>	<span class=o>[</span> ! -d <span class=nv>$BackDir</span>/<span class=nv>$list</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> mkdir -p <span class=nv>$BackDir</span>/<span class=nv>$list</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> table in <span class=nv>$ST</span>
</span></span><span class=line><span class=cl>	<span class=k>do</span>
</span></span><span class=line><span class=cl>		<span class=nv>$Dump</span> <span class=nv>$list</span> <span class=nv>$table</span><span class=p>|</span>gzip&gt;<span class=nv>$BackDir</span>/<span class=nv>$list</span>/<span class=nv>$table</span>.<span class=sb>`</span>date +%F<span class=sb>`</span>.sql.gz
</span></span><span class=line><span class=cl>		<span class=o>[</span> <span class=nv>$?</span> -eq <span class=m>0</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> action <span class=s2>&#34;</span><span class=nv>$list</span><span class=s2> &gt; </span><span class=nv>$table</span><span class=s2> is ok&#34;</span> /bin/true <span class=o>||</span> <span class=s2>&#34;</span><span class=nv>$list</span><span class=s2> &gt; </span><span class=nv>$table</span><span class=s2> dump is fail&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>done</span>
</span></span><span class=line><span class=cl><span class=k>done</span></span></span></code></pre></td></tr></table></div></div></div></div></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：ch03 - MySQL的备份与恢复</p><p>文章链接：<a href=https://www.oomkill.com/2017/05/ch3-mysql-backup-and-restore/ target=_blank>https://www.oomkill.com/2017/05/ch3-mysql-backup-and-restore/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2017/05/ch1-mysql-deployment/><span>ch01 - Linux下安装Mysql</span></a></li><li><a href=/2016/11/redis-install/><span>Redis安装</span></a></li><li><a href=/2016/11/redis-replication/><span>redis主从复制工作原理</span></a></li><li><a href=/2016/11/redis-subscribe-and-transaction/><span>redis事务与发布订阅</span></a></li><li><a href=/2016/11/redis-security/><span>redis安全相关配置</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/databases/>Databases</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2017/05/ch5-mysql-charset/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>ch05 - MySQL字符集相关配置</span>
</a><a class=next href=https://www.oomkill.com/2017/05/ch1-mysql-deployment/><span class=title></span>
<span>ch01 - Linux下安装Mysql&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/ch3 mysql backup and restore","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>