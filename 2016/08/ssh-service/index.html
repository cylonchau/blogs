<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SSH服务详解 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="Linux,ssh,SSH服务详解"><meta name=description content="什么是 SSH ？ SSH全称(SecureSHell)是一种网络协议，顾名思义就是非常安全的shell，主要用于计算机间加密传输。早期，互联网通信都是基于明文通信，一旦被截获，内容就暴露无遗。1995年，芬兰学者Tatu Ylonen设计了SSH协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为Linux系统的标准配置。
SSH服务是由OpenSSH服务端软件OpenSSH和客户端（常见的由SSH，SecureCRT，Xshell，putty）组成，默认使用22端口提供服务，有两个不兼容的ssh协议版本，分别为1.x和2.x。
SSH协议目前有SSH1和SSH2两个主流版本，SSH2协议兼容SSH1，强烈建议使用SSH2版本。目前实现SSH1和SSH2协议的主要软件有OpenSSH 和SSH Communications Security Corporation　公司的SSH Communications 软件。前者是OpenBSD组织开发的一款免费的SSH软件，后者是商业软件，因此在linux、FreeBSD、OpenBSD 、NetBSD等免费类UNIX系统种，通常都使用OpenSSH作为SSH协议的实现软件。
sh 1 2 3 $ rpm -qa openssh openssl openssl-1.0.1e-30.el6.x86_64 openssh-5.3p1-104.el6.x86_64 SSH1.x
每台ssh服务器主机都可以使用rsa加密方式来产生一个1024bit的RSAKey，这个RSA的加密方式就是用来产生公钥与私钥的算法之一，SSH1.x的整个联机加密步骤如下： 当SSH服务启动时，会产生一个768-bit的临时公钥（sshd_config配置文件中ServerKeyBits 768）存放在server中
sh 1 2 3 # centos5为768 centos6为1024 $ grep ServerKey /etc/ssh/sshd_config #ServerKeyBits 1024 当客户端联机请求传送过来时，服务器就会将这个768-bit的公钥传给客户端，此时客户端会将此公钥与先前存储的公钥进行对比，看是否一致。判断标准是服务器端联机用户目录下~/.ssh/know_hosts文件的内容（linux客户端）
sh 1 2 3 $ ssh -p22 lamp@192.168.65.62 $ ll .ssh/known_hosts -rw-r--r--. 1 root root 395 Jun 16 13:15 .ssh/known_hosts windows SecureCRT图示 在客户端接收到这个768-bit的Server Key后，客户端本地也会产生一个256bit的私钥（private key或host key），并且以加密的方式（具体的加密算法由客户端在服务器提供的所有可用算法中选择，默认为3DES算法），将Server key与host"><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2016/08/ssh-service/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2016/08/ssh-service/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script defer src=https://cdn.staticfile.net/jquery/3.5.1/jquery.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.css><script defer src=https://cdn.staticfile.net/fancybox/3.5.7/jquery.fancybox.min.js></script><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="SSH服务详解"><meta property="og:description" content="什么是 SSH ？ SSH全称(SecureSHell)是一种网络协议，顾名思义就是非常安全的shell，主要用于计算机间加密传输。早期，互联网通信都是基于明文通信，一旦被截获，内容就暴露无遗。1995年，芬兰学者Tatu Ylonen设计了SSH协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为Linux系统的标准配置。
SSH服务是由OpenSSH服务端软件OpenSSH和客户端（常见的由SSH，SecureCRT，Xshell，putty）组成，默认使用22端口提供服务，有两个不兼容的ssh协议版本，分别为1.x和2.x。
SSH协议目前有SSH1和SSH2两个主流版本，SSH2协议兼容SSH1，强烈建议使用SSH2版本。目前实现SSH1和SSH2协议的主要软件有OpenSSH 和SSH Communications Security Corporation　公司的SSH Communications 软件。前者是OpenBSD组织开发的一款免费的SSH软件，后者是商业软件，因此在linux、FreeBSD、OpenBSD 、NetBSD等免费类UNIX系统种，通常都使用OpenSSH作为SSH协议的实现软件。
sh 1 2 3 $ rpm -qa openssh openssl openssl-1.0.1e-30.el6.x86_64 openssh-5.3p1-104.el6.x86_64 SSH1.x
每台ssh服务器主机都可以使用rsa加密方式来产生一个1024bit的RSAKey，这个RSA的加密方式就是用来产生公钥与私钥的算法之一，SSH1.x的整个联机加密步骤如下： 当SSH服务启动时，会产生一个768-bit的临时公钥（sshd_config配置文件中ServerKeyBits 768）存放在server中
sh 1 2 3 # centos5为768 centos6为1024 $ grep ServerKey /etc/ssh/sshd_config #ServerKeyBits 1024 当客户端联机请求传送过来时，服务器就会将这个768-bit的公钥传给客户端，此时客户端会将此公钥与先前存储的公钥进行对比，看是否一致。判断标准是服务器端联机用户目录下~/.ssh/know_hosts文件的内容（linux客户端）
sh 1 2 3 $ ssh -p22 lamp@192.168.65.62 $ ll .ssh/known_hosts -rw-r--r--. 1 root root 395 Jun 16 13:15 .ssh/known_hosts windows SecureCRT图示 在客户端接收到这个768-bit的Server Key后，客户端本地也会产生一个256bit的私钥（private key或host key），并且以加密的方式（具体的加密算法由客户端在服务器提供的所有可用算法中选择，默认为3DES算法），将Server key与host"><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2016/08/ssh-service/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-08-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-22T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="SSH服务详解"><meta name=twitter:description content="什么是 SSH ？ SSH全称(SecureSHell)是一种网络协议，顾名思义就是非常安全的shell，主要用于计算机间加密传输。早期，互联网通信都是基于明文通信，一旦被截获，内容就暴露无遗。1995年，芬兰学者Tatu Ylonen设计了SSH协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为Linux系统的标准配置。
SSH服务是由OpenSSH服务端软件OpenSSH和客户端（常见的由SSH，SecureCRT，Xshell，putty）组成，默认使用22端口提供服务，有两个不兼容的ssh协议版本，分别为1.x和2.x。
SSH协议目前有SSH1和SSH2两个主流版本，SSH2协议兼容SSH1，强烈建议使用SSH2版本。目前实现SSH1和SSH2协议的主要软件有OpenSSH 和SSH Communications Security Corporation　公司的SSH Communications 软件。前者是OpenBSD组织开发的一款免费的SSH软件，后者是商业软件，因此在linux、FreeBSD、OpenBSD 、NetBSD等免费类UNIX系统种，通常都使用OpenSSH作为SSH协议的实现软件。
sh 1 2 3 $ rpm -qa openssh openssl openssl-1.0.1e-30.el6.x86_64 openssh-5.3p1-104.el6.x86_64 SSH1.x
每台ssh服务器主机都可以使用rsa加密方式来产生一个1024bit的RSAKey，这个RSA的加密方式就是用来产生公钥与私钥的算法之一，SSH1.x的整个联机加密步骤如下： 当SSH服务启动时，会产生一个768-bit的临时公钥（sshd_config配置文件中ServerKeyBits 768）存放在server中
sh 1 2 3 # centos5为768 centos6为1024 $ grep ServerKey /etc/ssh/sshd_config #ServerKeyBits 1024 当客户端联机请求传送过来时，服务器就会将这个768-bit的公钥传给客户端，此时客户端会将此公钥与先前存储的公钥进行对比，看是否一致。判断标准是服务器端联机用户目录下~/.ssh/know_hosts文件的内容（linux客户端）
sh 1 2 3 $ ssh -p22 lamp@192.168.65.62 $ ll .ssh/known_hosts -rw-r--r--. 1 root root 395 Jun 16 13:15 .ssh/known_hosts windows SecureCRT图示 在客户端接收到这个768-bit的Server Key后，客户端本地也会产生一个256bit的私钥（private key或host key），并且以加密的方式（具体的加密算法由客户端在服务器提供的所有可用算法中选择，默认为3DES算法），将Server key与host"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"SSH服务详解","item":"https://www.oomkill.com/2016/08/ssh-service/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SSH服务详解","name":"SSH服务详解","description":"什么是 SSH ？ SSH全称(SecureSHell)是一种网络协议，顾名思义就是非常安全的shell，主要用于计算机间加密传输。早期，互联网通信都是基于明文通信，一旦被截获，内容就暴露无遗。1995年，芬兰学者Tatu Ylonen设计了SSH协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为Linux系统的标准配置。\nSSH服务是由OpenSSH服务端软件OpenSSH和客户端（常见的由SSH，SecureCRT，Xshell，putty）组成，默认使用22端口提供服务，有两个不兼容的ssh协议版本，分别为1.x和2.x。\nSSH协议目前有SSH1和SSH2两个主流版本，SSH2协议兼容SSH1，强烈建议使用SSH2版本。目前实现SSH1和SSH2协议的主要软件有OpenSSH 和SSH Communications Security Corporation　公司的SSH Communications 软件。前者是OpenBSD组织开发的一款免费的SSH软件，后者是商业软件，因此在linux、FreeBSD、OpenBSD 、NetBSD等免费类UNIX系统种，通常都使用OpenSSH作为SSH协议的实现软件。\nsh 1 2 3 $ rpm -qa openssh openssl openssl-1.0.1e-30.el6.x86_64 openssh-5.3p1-104.el6.x86_64 SSH1.x\n每台ssh服务器主机都可以使用rsa加密方式来产生一个1024bit的RSAKey，这个RSA的加密方式就是用来产生公钥与私钥的算法之一，SSH1.x的整个联机加密步骤如下： 当SSH服务启动时，会产生一个768-bit的临时公钥（sshd_config配置文件中ServerKeyBits 768）存放在server中\nsh 1 2 3 # centos5为768 centos6为1024 $ grep ServerKey /etc/ssh/sshd_config #ServerKeyBits 1024 当客户端联机请求传送过来时，服务器就会将这个768-bit的公钥传给客户端，此时客户端会将此公钥与先前存储的公钥进行对比，看是否一致。判断标准是服务器端联机用户目录下~/.ssh/know_hosts文件的内容（linux客户端）\nsh 1 2 3 $ ssh -p22 lamp@192.168.65.62 $ ll .ssh/known_hosts -rw-r--r--. 1 root root 395 Jun 16 13:15 .ssh/known_hosts windows SecureCRT图示 在客户端接收到这个768-bit的Server Key后，客户端本地也会产生一个256bit的私钥（private key或host key），并且以加密的方式（具体的加密算法由客户端在服务器提供的所有可用算法中选择，默认为3DES算法），将Server key与host","keywords":["Linux","ssh","SSH服务详解"],"articleBody":"什么是 SSH ？ SSH全称(SecureSHell)是一种网络协议，顾名思义就是非常安全的shell，主要用于计算机间加密传输。早期，互联网通信都是基于明文通信，一旦被截获，内容就暴露无遗。1995年，芬兰学者Tatu Ylonen设计了SSH协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为Linux系统的标准配置。\nSSH服务是由OpenSSH服务端软件OpenSSH和客户端（常见的由SSH，SecureCRT，Xshell，putty）组成，默认使用22端口提供服务，有两个不兼容的ssh协议版本，分别为1.x和2.x。\nSSH协议目前有SSH1和SSH2两个主流版本，SSH2协议兼容SSH1，强烈建议使用SSH2版本。目前实现SSH1和SSH2协议的主要软件有OpenSSH 和SSH Communications Security Corporation　公司的SSH Communications 软件。前者是OpenBSD组织开发的一款免费的SSH软件，后者是商业软件，因此在linux、FreeBSD、OpenBSD 、NetBSD等免费类UNIX系统种，通常都使用OpenSSH作为SSH协议的实现软件。\nsh 1 2 3 $ rpm -qa openssh openssl openssl-1.0.1e-30.el6.x86_64 openssh-5.3p1-104.el6.x86_64 SSH1.x\n每台ssh服务器主机都可以使用rsa加密方式来产生一个1024bit的RSAKey，这个RSA的加密方式就是用来产生公钥与私钥的算法之一，SSH1.x的整个联机加密步骤如下： 当SSH服务启动时，会产生一个768-bit的临时公钥（sshd_config配置文件中ServerKeyBits 768）存放在server中\nsh 1 2 3 # centos5为768 centos6为1024 $ grep ServerKey /etc/ssh/sshd_config #ServerKeyBits 1024 当客户端联机请求传送过来时，服务器就会将这个768-bit的公钥传给客户端，此时客户端会将此公钥与先前存储的公钥进行对比，看是否一致。判断标准是服务器端联机用户目录下~/.ssh/know_hosts文件的内容（linux客户端）\nsh 1 2 3 $ ssh -p22 lamp@192.168.65.62 $ ll .ssh/known_hosts -rw-r--r--. 1 root root 395 Jun 16 13:15 .ssh/known_hosts windows SecureCRT图示 在客户端接收到这个768-bit的Server Key后，客户端本地也会产生一个256bit的私钥（private key或host key），并且以加密的方式（具体的加密算法由客户端在服务器提供的所有可用算法中选择，默认为3DES算法），将Server key与host\nSSHD_CONFIG配置文件详解 参数选项 注释说明 Port Num 指定sshd服务器侦听端口num。将num改成非标准端口可以提高安全性。默认端口为22。 Protocol 1|2|2,1 指定 sshd 支持的SSH协议的版本号。'1'和'2'表示仅仅支持SSH-1和SSH-2协议。\"2,1\"表示同时支持SSH-1和SSH-2协议。 PubkeyAuthentication 是否允许公钥认证。仅可以用于SSH-2。默认值为\"yes\"。 ListenAddress 0.0.0.0 监听的IP，默认监听所有地址（可指定多个监听的地址），可使用以下格式：\nListenAddress\nhost | IPv4_addr | IPv6_addr\nListenAddress host | IPv4_addr:port\nListenAddress [host|IPv6_addr]:port\n举例说明：如果您有两个 IP，分别是 192.168.0.100 及 192.168.2.20 ，那么只想要开放 192.168.0.100 时，就可以写如同下面的样式：ListenAddress 192.168.0.100只监听来自 192.168.0.100 这个 IP 的SSH联机。 HostKey /etc/ssh/ssh_host_key SSH version 1 使用的私钥 HostKey /etc/ssh/ssh_host_rsa_key SSH version 2 使用的 RSA 私钥 HostKey /etc/ssh/ssh_host_dsa_key SSH version 2 使用的 DSA 私钥 KeyRegenerationInterval 1h 由前面联机的说明可以知道， version 1 会使用 server 的 Public Key ，那么如果这个 Public Key 被偷的话，岂不完蛋？所以需要每隔一段时间来重新建立一次！这里的时间为秒！ ServerKeyBits 768 定义服务器密匙的位数，centos5 768，centos6 1024 SyslogFacility 指定 sshd(8) 将日志消息通过哪个日志子系统(facility)发送。有效值是：DAEMON, USER, AUTH(默认), LOCAL0, LOCAL1, LOCAL2, LOCAL3, LOCAL4, LOCAL5, LOCAL6, LOCAL7 LogLevel 指定 sshd(8) 的日志等级(详细程度)。可用值如下：QUIET, FATAL, ERROR, INFO(默认), VERBOSE, DEBUG, DEBUG1, DEBUG2, DEBUG3\nDEBUG 与 DEBUG1 等价；DEBUG2 和 DEBUG3 则分别指定了更详细、更罗嗦的日志输出。\n注：比 DEBUG 更详细的日志可能会泄漏用户的敏感信息，因此反对使用。 LoginGraceTime 2m 当使用者连上 SSH server 之后，会出现输入密码的画面，在该画面中，在多久时间内没有成功连上 SSH server ，就断线！时间为默认为秒，可加时间标志m,h PermitRootLogin 是否允许 root 登录。可用值如下：\n“yes”(默认) 表示允许。“no\"表示禁止。\n“without-password\"表示禁止使用密码认证登录。\n“forced-commands-only\"表示只有在指定了 command 选项的情况下才允许使用公钥认证登录。同时其它认证方法全部被禁止。这个值常用于做远程备份之类的事情。 StrictModes 指定是否要求 sshd 在接受连接请求前对用户主目录和相关的配置文件进行宿主和权限检查。强烈建议使用默认值\"yes\"来预防可能出现的低级错误。 MaxAuthTries 指定每个连接最大允许的认证次数。默认值是 6 。如果失败认证的次数超过这个数值的一半，连接将被强制断开，且会生成额外的失败日志消息。 PubkeyAuthentication 是否允许公钥认证。仅可以用于SSH-2。默认值为\"yes\"。 AuthorizedKeysFile 存放该用户可以用来登录的 RSA/DSA 公钥。该指令中可以使用下列根据连接时的实际情况进行展开的符号：\n%% 表示’%’\n%h 表示用户的主目录\n%u 表示该用户的用户名。\n经过扩展之后的值必须要么是绝对路径，要么是相对于用户主目录的相对路径。默认值是\".ssh/authorized_keys\"。 IgnoreRhosts 是否在 RhostsRSAAuthentication 或 HostbasedAuthentication 过程中忽略 .rhosts 和 .shosts 文件。不过 /etc/hosts.equiv 和 /etc/shosts.equiv 仍将被使用。推荐设为默认值\"yes\" IgnoreUserKnownHosts 是否在 RhostsRSAAuthentication 或 HostbasedAuthentication 过程中忽略用户的 ~/.ssh/known_hosts 文件。\n默认值是\"no\"。为了提高安全性，可以设为\"yes\"。 PasswordAuthentication 是否允许使用基于密码的认证。默认为\"yes\"。 PermitEmptyPasswords 是否允许密码为空的用户远程登录。默认为\"no\"。 UseDNS 指定 sshd是否应该对远程主机名进行反向解析，以检查此主机名是否与其IP地址真实对应。默认值为\"yes\"。。 PidFile 指定在哪个文件中存放SSH守护进程的进程号，默认为/var/run/sshd.pid。文件。 MaxStartups 最大允许保持多少个未认证的连接。默认值是 10 。到达限制后，将不再接受新连接，除非先前的连接认证成功或超出 LoginGraceTime 的限制。 SSH服务的认证类型 从ssh客户端来看，SSH服务主要提供两种级别的安全验证，具体级别如下：\n基于口令的安全验证 基于口令的安全验证是大家一直用的，只要知道服务器的SSH连接账号和口令（对应的服务器IP与开放的SSH端口，默认22），就可以通过ssh客户端登陆到这台远程主机。此时联机过程中所有传输的数据都是加密的。\n口令验证测试\nsh 1 2 3 4 5 6 7 8 9 $ ssh -p52113 root@192.168.252.61 The authenticity of host '[192.168.252.61]:52113 ([192.168.252.61]:52113)' can't be established. RSA key fingerprint is 38:68:34:4e:09:c0:75:18:be:72:17:20:2c:95:0a:e6. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added '[192.168.252.61]:52113' (RSA) to the list of known hosts. root@192.168.252.61's password: Last login: Thu May 11 21:37:33 2017 from 192.168.252.1 $ 基于秘钥的安全验证 基于秘钥的安全验证方式是指，需要依靠秘钥。也就是必须实现建立一对秘钥对，然后吧公用秘钥（public key）放在需要访问的目标服务器上，另外，还需要把私钥（private key）放到SSH客户端或对应的客户端服务器上。\n此时，如果想要连接到这个带有公用秘钥的SSH服务器，客户端SSH软件或客户端服务器就会向SSH服务器发出请求，请求用联机的用户秘钥进行安全验证。SSH服务器收到请求后，会先在该SSH服务器上连接的用户的家目录下寻找事先放上去的对应用户的公共密钥，然后把它和连接的SSH客户端发送过来的公用密钥进行比较。如果两个密钥一致，SSH服务器就用公用密钥加密“质询”（challenge）并把他发送给SSH客户端。\nSSH客户端收到“质询”之后就可以用自己的私钥解密，再把发送给SSH服务器。使用这种方式，需要使用联机用户的密钥文件。与第一种基于口令验证的方式相比，第二种方式不需要在网络上传送口令密码，所以安全性更高了，这时我们也要注意保护我们的密钥文件。特别是私钥文件，一旦被黑客获取，危险就大了。\n基于密钥的安全认证也有windows客户端与linux客户端的区别\nWINDOWS下使用秘钥方式登陆linux 方法一：在linux服务器上生成密钥对\nsh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 $ ssh-keygen -t dsa Generating public/private dsa key pair. # 输入文件中要保存的key Enter file in which to save the key (/root/.ssh/id_dsa): zhangsan # 输入一个要解密的密码，空为无密码 Enter passphrase (empty for no passphrase): # 再次输入密码，空为无密码 Enter same passphrase again: # 身份证明以保存至zhangsan这个文件 Your identification has been saved in zhangsan. # 公钥以保存为zhangsan.pub这个文件 Your public key has been saved in zhangsan.pub. # lamp主机的root用户的key的指纹为那些 The key fingerprint is: 10:d2:e8:03:30:4b:c9:8b:76:97:d0:6e:09:52:f7:06 root@lamp The key's randomart image is: +--[ DSA 1024]----+ |+oo.oE. | |.*.ooo+. | |o oo+ +o | |.o .o*.. | |. . o. S | | | | | | | | | +-----------------+ $ ls known_hosts zhangsan zhangsan.pub # 在服务器上将公钥重命名,名字错误将验证不成功 $ mv id_dsa.pub authorized_keys # 查看是否重命名成功 $ ll -rw-r--r--. 1 root root 599 Jun 17 03:23 authorized_keys -rw-------. 1 root root 668 Jun 17 03:23 id_dsa # 修改公钥权限 $ chmod 600 authorized_keys # 查看公钥权限是否修改成功 $ ll -rw-------. 1 root root 599 Jun 17 03:23 authorized_keys -rw-------. 1 root root 668 Jun 17 03:23 id_dsa 使用SecureCRT将私钥转换为openSSH格式的私钥\n选择之前下载的私钥的路径\n如果没输入密码则无这一步\n测试过程\n方法二：使用SecureCRT创建秘钥对\n选择当前要生成的秘钥窗口，然后点击“工具”中的创建公钥选项，如下图所示： 秘钥生成向导选择下一步，如下图所示： 秘钥类型选择DSA或RSA，然后点击下一步，如下图所示： 生成秘钥长度，保持默认即可，如下图所示： 秘钥生成过程，如下图所示： 秘钥生成后选择下一步，如下图所示： 秘钥生成后，点击下一步，选择秘钥的私钥保存的路径和，然后点击完成。如下图所示： 点击完成后，弹出是否使用此秘钥为全局公钥，以个人习惯选择是或否，这里选择否，如下图所示： 将SecureCRT生成的公钥上传到linux服务器上 sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # 创建公钥存放目录 $ mkdir .ssh # 修改.ssh目录的权限 $ chmod 700 .ssh/ # 查看ssh2兼容格式转换成openssh的格式结果 $ ssh-keygen -i -f Identity.pub ssh-dss AAAAB3NzaC1kc3MAAACBAIJLJsIZJ0G/RKBnWQ04uRfqnv3Vkm8iusrI3Bm784lP64kn/IVZnC/2wcs6xjwjuGFt8GgNVKty+ s5/jf4uMBse7Ju3alIv42iOmS5+qeztb3Yio1r0rEjLcEdFZVEW3dbVsYX3ufwvBa9GhPum4q3eYwY7TziKR9ub2UJZTqVzAAAAFQDSfk HVhjW7J80YBBI2PdqVcRfZ3wAAAIBwmHcLm+BVCcMmpKfYzl+W1/79Cd7vSbeFMW+linn82Li/RcVnWF47hxeKwOwJ/O2UJ879cW1xPUG nJUNfEvHJs93rn3zthlbwLCmyH8Ugp2pF38DgyydbU6Xs/6lyiUc14WlzvL3QqO1H+QBX/18ZgXsZjoxakd86pz329r9wTgAAAIAVakBN 8DtSRZqPLeaXDhevg3texOTlmDsmhmqBcAOmH6VnzP1VB0E8DhTB8/MWJChSJalslyEzaa1PhBNwZEn3SmG6vWe+CXSuEtHBXbVBQHsDb xois6L+oqkL86PA7JdzTDSfiZKoGOks5f37Qb+CREnhyYcXJIjPZTE/0aIsdA== # 将ssh2兼容格式转换成openssl的格式结果 $ ssh-keygen -i -f Identity.pub \u003e\u003e.ssh/authorized_keys # 修改公钥的权限 $ chmod 600 .ssh/authorized_keys # 查看权限是否修改成功 $ ll .ssh/ -rw-------. 1 root root 589 Jun 17 04:37 authorized_keys 测试结果 新建快速链接，在鉴权中选择公钥，如下图所示： 如果设置了通行短语，就会出现以下框\n裸奔的后果！一次ssh被篡改的入侵事件\n扫描端口实例：牤牛阵解决ssh安全问题\nsh 1 2 3 4 5 6 7 8 9 10 11 $ nmap 192.168.65.62 -p1-65535 Starting Nmap 5.51 ( http://nmap.org ) at 2016-06-17 05:11 CST Nmap scan report for 192.168.65.62 Host is up (0.0000040s latency). Not shown: 65532 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 3306/tcp open mysql Nmap done: 1 IP address (1 host up) scanned in 0.79 seconds ","wordCount":"707","inLanguage":"zh","datePublished":"2016-08-05T00:00:00Z","dateModified":"2023-03-22T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2016/08/ssh-service/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">SSH服务详解</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2016-08-05</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>707 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>4 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/linux/>#Linux</a>
<a href=https://www.oomkill.com/tags/ssh/>#Ssh</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%af-ssh- aria-label="什么是 SSH ？">什么是 SSH ？</a><li><a href=#sshd_config%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%a6%e8%a7%a3 aria-label=SSHD_CONFIG配置文件详解>SSHD_CONFIG配置文件详解</a><li><a href=#ssh%e6%9c%8d%e5%8a%a1%e7%9a%84%e8%ae%a4%e8%af%81%e7%b1%bb%e5%9e%8b aria-label=SSH服务的认证类型>SSH服务的认证类型</a><ul><li><a href=#%e5%9f%ba%e4%ba%8e%e5%8f%a3%e4%bb%a4%e7%9a%84%e5%ae%89%e5%85%a8%e9%aa%8c%e8%af%81 aria-label=基于口令的安全验证>基于口令的安全验证</a><li><a href=#%e5%9f%ba%e4%ba%8e%e7%a7%98%e9%92%a5%e7%9a%84%e5%ae%89%e5%85%a8%e9%aa%8c%e8%af%81 aria-label=基于秘钥的安全验证>基于秘钥的安全验证</a></ul><li><a href=#windows%e4%b8%8b%e4%bd%bf%e7%94%a8%e7%a7%98%e9%92%a5%e6%96%b9%e5%bc%8f%e7%99%bb%e9%99%86linux aria-label=WINDOWS下使用秘钥方式登陆linux>WINDOWS下使用秘钥方式登陆linux</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><h2 id=什么是-ssh->什么是 SSH ？<a hidden class=anchor aria-hidden=true href=#什么是-ssh->#</a></h2><p>SSH全称(<font color=#f8070d size=3><strong>S</strong></font>ecure<font color=#f8070d size=3><strong>SH</strong></font>ell)是一种网络协议，顾名思义就是非常安全的shell，主要用于计算机间加密传输。早期，互联网通信都是基于明文通信，一旦被截获，内容就暴露无遗。1995年，芬兰学者Tatu Ylonen设计了SSH协议，将登录信息全部加密，成为互联网安全的一个基本解决方案，迅速在全世界获得推广，目前已经成为Linux系统的标准配置。</p><p>SSH服务是由OpenSSH服务端软件OpenSSH和客户端（常见的由SSH，SecureCRT，Xshell，putty）组成，默认使用<font color=#f8070d size=3><strong>22</strong></font>端口提供服务，有两个不兼容的ssh协议版本，分别为1.x和2.x。</p><p>SSH协议目前有SSH1和SSH2两个主流版本，SSH2协议兼容SSH1，强烈建议使用SSH2版本。目前实现SSH1和SSH2协议的主要软件有OpenSSH 和SSH Communications Security Corporation　公司的SSH Communications 软件。前者是OpenBSD组织开发的一款免费的SSH软件，后者是商业软件，因此在linux、FreeBSD、OpenBSD 、NetBSD等免费类UNIX系统种，通常都使用OpenSSH作为SSH协议的实现软件。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ rpm -qa openssh openssl
</span></span><span class=line><span class=cl>openssl-1.0.1e-30.el6.x86_64
</span></span><span class=line><span class=cl>openssh-5.3p1-104.el6.x86_64</span></span></code></pre></td></tr></table></div></div></div></div><blockquote><p><strong>SSH1.x</strong></p></blockquote><p>每台ssh服务器主机都可以使用rsa加密方式来产生一个1024bit的RSAKey，这个RSA的加密方式就是用来产生公钥与私钥的算法之一，SSH1.x的整个联机加密步骤如下：
当SSH服务启动时，会产生一个768-bit的临时公钥（sshd_config配置文件中ServerKeyBits 768）存放在server中</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># centos5为768 centos6为1024</span>
</span></span><span class=line><span class=cl>$ grep ServerKey /etc/ssh/sshd_config 
</span></span><span class=line><span class=cl><span class=c1>#ServerKeyBits 1024</span></span></span></code></pre></td></tr></table></div></div></div></div><p>当客户端联机请求传送过来时，服务器就会将这个768-bit的公钥传给客户端，此时客户端会将此公钥与先前存储的公钥进行对比，看是否一致。判断标准是服务器端联机用户目录下~/.ssh/know_hosts文件的内容（linux客户端）</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ssh -p22 lamp@192.168.65.62
</span></span><span class=line><span class=cl>$ ll .ssh/known_hosts 
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root <span class=m>395</span> Jun <span class=m>16</span> 13:15 .ssh/known_hosts</span></span></code></pre></td></tr></table></div></div></div></div><p>windows SecureCRT图示
在客户端接收到这个768-bit的Server Key后，客户端本地也会产生一个256bit的私钥（private key或host key），并且以加密的方式（具体的加密算法由客户端在服务器提供的所有可用算法中选择，默认为3DES算法），将Server key与host</p><h2 id=sshd_config配置文件详解>SSHD_CONFIG配置文件详解<a hidden class=anchor aria-hidden=true href=#sshd_config配置文件详解>#</a></h2><table><thead><tr><th>参数选项</th><th>注释说明</th></tr></thead><tbody><tr><td>Port <em>Num</em></td><td>指定sshd服务器侦听端口num。将num改成非标准端口可以提高安全性。默认端口为22。</td></tr><tr><td>Protocol 1|2|2,1</td><td>指定 sshd 支持的SSH协议的版本号。<code>'1'</code>和<code>'2'</code>表示仅仅支持SSH-1和SSH-2协议。<code>"2,1"</code>表示同时支持SSH-1和SSH-2协议。</td></tr><tr><td>PubkeyAuthentication</td><td>是否允许公钥认证。仅可以用于SSH-2。默认值为<font color=#f8070d size=3><code>"yes"</code></font>。</td></tr><tr><td>ListenAddress 0.0.0.0</td><td>监听的IP，默认监听所有地址（可指定多个监听的地址），可使用以下格式：<br>ListenAddress<br>host | IPv4_addr | IPv6_addr<br>ListenAddress host | IPv4_addr:port<br>ListenAddress [host|IPv6_addr]:port<br>举例说明：如果您有两个 IP，分别是 192.168.0.100 及 192.168.2.20 ，那么只想要开放 192.168.0.100 时，就可以写如同下面的样式：ListenAddress 192.168.0.100只监听来自 192.168.0.100 这个 IP 的SSH联机。</td></tr><tr><td>HostKey /etc/ssh/ssh_host_key</td><td>SSH version 1 使用的私钥</td></tr><tr><td>HostKey /etc/ssh/ssh_host_rsa_key</td><td>SSH version 2 使用的 RSA 私钥</td></tr><tr><td>HostKey /etc/ssh/ssh_host_dsa_key</td><td>SSH version 2 使用的 DSA 私钥</td></tr><tr><td>KeyRegenerationInterval 1h</td><td>由前面联机的说明可以知道， version 1 会使用 server 的 Public Key ，那么如果这个 Public Key 被偷的话，岂不完蛋？所以需要每隔一段时间来重新建立一次！这里的时间为秒！</td></tr><tr><td>ServerKeyBits 768</td><td>定义服务器密匙的位数，centos5 768，centos6 1024</td></tr><tr><td>SyslogFacility</td><td>指定 sshd(8) 将日志消息通过哪个日志子系统(facility)发送。有效值是：DAEMON, USER, AUTH(默认), LOCAL0, LOCAL1, LOCAL2, LOCAL3, LOCAL4, LOCAL5, LOCAL6, LOCAL7</td></tr><tr><td>LogLevel</td><td>指定 sshd(8) 的日志等级(详细程度)。可用值如下：QUIET, FATAL, ERROR, INFO(默认), VERBOSE, DEBUG, DEBUG1, DEBUG2, DEBUG3<br>DEBUG 与 DEBUG1 等价；DEBUG2 和 DEBUG3 则分别指定了更详细、更罗嗦的日志输出。<br><font color=#0215cd size=3>注：比 DEBUG 更详细的日志可能会泄漏用户的敏感信息，因此反对使用。<font></td></tr><tr><td>LoginGraceTime 2m</td><td>当使用者连上 SSH server 之后，会出现输入密码的画面，在该画面中，在多久时间内没有成功连上 SSH server ，就断线！时间为默认为秒，可加时间标志m,h</td></tr><tr><td>PermitRootLogin</td><td>是否允许 root 登录。可用值如下：<br>&ldquo;yes&rdquo;(默认) 表示允许。&ldquo;no"表示禁止。<br>&ldquo;without-password"表示禁止使用密码认证登录。<br>&ldquo;forced-commands-only"表示只有在指定了 command 选项的情况下才允许使用公钥认证登录。同时其它认证方法全部被禁止。这个值常用于做远程备份之类的事情。</td></tr><tr><td>StrictModes</td><td>指定是否要求 sshd 在接受连接请求前对用户主目录和相关的配置文件进行宿主和权限检查。强烈建议使用默认值"yes"来预防可能出现的低级错误。</td></tr><tr><td>MaxAuthTries</td><td>指定每个连接最大允许的认证次数。默认值是 6 。如果失败认证的次数超过这个数值的一半，连接将被强制断开，且会生成额外的失败日志消息。</td></tr><tr><td>PubkeyAuthentication</td><td>是否允许公钥认证。仅可以用于SSH-2。默认值为<font color=#f8070d size=3><code>"yes"</code></font>。</td></tr><tr><td>AuthorizedKeysFile</td><td>存放该用户可以用来登录的 RSA/DSA 公钥。该指令中可以使用下列根据连接时的实际情况进行展开的符号：<br><em><strong>%% 表示&rsquo;%&rsquo;</strong></em><br><em><strong>%h 表示用户的主目录</strong></em><br><em><strong>%u 表示该用户的用户名</strong></em>。<br>经过扩展之后的值必须要么是绝对路径，要么是相对于用户主目录的相对路径。默认值是<font color=#f8070d size=3><code>".ssh/authorized_keys"</code></font>。</td></tr><tr><td>IgnoreRhosts</td><td>是否在 RhostsRSAAuthentication 或 HostbasedAuthentication 过程中忽略 .rhosts 和 .shosts 文件。不过 /etc/hosts.equiv 和 /etc/shosts.equiv 仍将被使用。推荐设为默认值<font color=#f8070d size=3><code>"yes"</code></font></td></tr><tr><td>IgnoreUserKnownHosts</td><td>是否在 RhostsRSAAuthentication 或 HostbasedAuthentication 过程中忽略用户的 ~/.ssh/known_hosts 文件。<br>默认值是<font color=#f8070d size=3><code>"no"</code></font>。为了提高安全性，可以设为<font color=#f8070d size=3><code>"yes"</code></font>。</td></tr><tr><td>PasswordAuthentication</td><td>是否允许使用基于密码的认证。默认为<font color=#f8070d size=3><code>"yes"</code></font>。</td></tr><tr><td>PermitEmptyPasswords</td><td>是否允许密码为空的用户远程登录。默认为<font color=#f8070d size=3><code>"no"</code></font>。</td></tr><tr><td>UseDNS</td><td>指定 sshd是否应该对远程主机名进行反向解析，以检查此主机名是否与其IP地址真实对应。默认值为<font color=#f8070d size=3><code>"yes"</code></font>。。</td></tr><tr><td>PidFile</td><td>指定在哪个文件中存放SSH守护进程的进程号，默认为<font color=#f8070d size=3><code>/var/run/sshd.pid</code></font>。文件。</td></tr><tr><td>MaxStartups</td><td>最大允许保持多少个未认证的连接。默认值是 10 。到达限制后，将不再接受新连接，除非先前的连接认证成功或超出 LoginGraceTime 的限制。</td></tr></tbody></table><h2 id=ssh服务的认证类型>SSH服务的认证类型<a hidden class=anchor aria-hidden=true href=#ssh服务的认证类型>#</a></h2><p>从ssh客户端来看，SSH服务主要提供两种级别的安全验证，具体级别如下：</p><h3 id=基于口令的安全验证>基于口令的安全验证<a hidden class=anchor aria-hidden=true href=#基于口令的安全验证>#</a></h3><p>基于口令的安全验证是大家一直用的，只要知道服务器的SSH连接账号和口令（对应的服务器IP与开放的SSH端口，默认22），就可以通过ssh客户端登陆到这台远程主机。此时联机过程中所有传输的数据都是加密的。</p><blockquote><p><strong>口令验证测试</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ssh -p52113 root@192.168.252.61
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  The authenticity of host <span class=s1>&#39;[192.168.252.61]:52113 ([192.168.252.61]:52113)&#39;</span> can<span class=s1>&#39;t be established.
</span></span></span><span class=line><span class=cl><span class=s1>RSA key fingerprint is 38:68:34:4e:09:c0:75:18:be:72:17:20:2c:95:0a:e6.
</span></span></span><span class=line><span class=cl><span class=s1>Are you sure you want to continue connecting (yes/no)? yes 
</span></span></span><span class=line><span class=cl><span class=s1>Warning: Permanently added &#39;</span><span class=o>[</span>192.168.252.61<span class=o>]</span>:52113<span class=s1>&#39; (RSA) to the list of known hosts.
</span></span></span><span class=line><span class=cl><span class=s1>root@192.168.252.61&#39;</span>s password: 
</span></span><span class=line><span class=cl>Last login: Thu May <span class=m>11</span> 21:37:33 <span class=m>2017</span> from 192.168.252.1
</span></span><span class=line><span class=cl>$   </span></span></code></pre></td></tr></table></div></div></div></div><h3 id=基于秘钥的安全验证>基于秘钥的安全验证<a hidden class=anchor aria-hidden=true href=#基于秘钥的安全验证>#</a></h3><p>基于秘钥的安全验证方式是指，需要依靠秘钥。也就是必须实现建立一对秘钥对，然后吧<font style=background:#ff0 size=3>公用秘钥<font color=#f8070d size=3>（public key）</font>放在需要访问的目标服务器上</font>，另外，还需要把<font style=background:#ff0 size=3>私钥<font color=#f8070d size=3>（private key）</font>放到SSH客户端或对应的客户端服务器上</font>。</p><p>此时，如果想要连接到这个带有公用秘钥的SSH服务器，客户端SSH软件或客户端服务器就会向SSH服务器发出请求，请求用联机的用户秘钥进行安全验证。SSH服务器收到请求后，会先在该SSH服务器上连接的用户的家目录下寻找事先放上去的对应用户的公共密钥，然后把它和连接的SSH客户端发送过来的公用密钥进行比较。如果两个密钥一致，SSH服务器就用公用密钥加密“质询”（challenge）并把他发送给SSH客户端。</p><p>SSH客户端收到“质询”之后就可以用自己的私钥解密，再把发送给SSH服务器。使用这种方式，需要使用联机用户的密钥文件。与第一种基于口令验证的方式相比，第二种方式<font style=background:#ff0 size=3>不需要在网络上传送口令密码</font>，所以安全性更高了，这时我们也要注意保护我们的密钥文件。特别是私钥文件，一旦被黑客获取，危险就大了。</p><p>基于密钥的安全认证也有windows客户端与linux客户端的区别</p><h2 id=windows下使用秘钥方式登陆linux>WINDOWS下使用秘钥方式登陆linux<a hidden class=anchor aria-hidden=true href=#windows下使用秘钥方式登陆linux>#</a></h2><blockquote><p><strong>方法一：在linux服务器上生成密钥对</strong></p></blockquote><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ssh-keygen -t dsa
</span></span><span class=line><span class=cl>Generating public/private dsa key pair.
</span></span><span class=line><span class=cl><span class=c1># 输入文件中要保存的key</span>
</span></span><span class=line><span class=cl>Enter file in which to save the key <span class=o>(</span>/root/.ssh/id_dsa<span class=o>)</span>: zhangsan
</span></span><span class=line><span class=cl><span class=c1># 输入一个要解密的密码，空为无密码</span>
</span></span><span class=line><span class=cl>Enter passphrase <span class=o>(</span>empty <span class=k>for</span> no passphrase<span class=o>)</span>: 
</span></span><span class=line><span class=cl><span class=c1># 再次输入密码，空为无密码</span>
</span></span><span class=line><span class=cl>Enter same passphrase again: 
</span></span><span class=line><span class=cl><span class=c1># 身份证明以保存至zhangsan这个文件</span>
</span></span><span class=line><span class=cl>Your identification has been saved in zhangsan.
</span></span><span class=line><span class=cl><span class=c1># 公钥以保存为zhangsan.pub这个文件</span>
</span></span><span class=line><span class=cl>Your public key has been saved in zhangsan.pub.
</span></span><span class=line><span class=cl><span class=c1># lamp主机的root用户的key的指纹为那些</span>
</span></span><span class=line><span class=cl>The key fingerprint is:
</span></span><span class=line><span class=cl>10:d2:e8:03:30:4b:c9:8b:76:97:d0:6e:09:52:f7:06 root@lamp
</span></span><span class=line><span class=cl>The key<span class=err>&#39;</span>s randomart image is:
</span></span><span class=line><span class=cl>+--<span class=o>[</span> DSA 1024<span class=o>]</span>----+
</span></span><span class=line><span class=cl><span class=p>|</span>+oo.oE.          	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>.*.ooo+.         	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>o oo+ +o         	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>.o .o*..         	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>. . o.  S        	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>                 	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>                 	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>                 	<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>                 	<span class=p>|</span>
</span></span><span class=line><span class=cl>+-----------------+
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>known_hosts  zhangsan  zhangsan.pub
</span></span><span class=line><span class=cl><span class=c1># 在服务器上将公钥重命名,名字错误将验证不成功</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mv id_dsa.pub authorized_keys
</span></span><span class=line><span class=cl><span class=c1># 查看是否重命名成功</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ll
</span></span><span class=line><span class=cl>-rw-r--r--. <span class=m>1</span> root root <span class=m>599</span> Jun <span class=m>17</span> 03:23 authorized_keys
</span></span><span class=line><span class=cl>-rw-------. <span class=m>1</span> root root <span class=m>668</span> Jun <span class=m>17</span> 03:23 id_dsa
</span></span><span class=line><span class=cl><span class=c1># 修改公钥权限</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ chmod <span class=m>600</span> authorized_keys 
</span></span><span class=line><span class=cl><span class=c1># 查看公钥权限是否修改成功</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ll
</span></span><span class=line><span class=cl>-rw-------. <span class=m>1</span> root root <span class=m>599</span> Jun <span class=m>17</span> 03:23 authorized_keys
</span></span><span class=line><span class=cl>-rw-------. <span class=m>1</span> root root <span class=m>668</span> Jun <span class=m>17</span> 03:23 id_dsa  </span></span></code></pre></td></tr></table></div></div></div></div><p>使用SecureCRT将私钥转换为openSSH格式的私钥</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233019524.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233019524.png#center alt=image-20221214233019524 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>选择之前下载的私钥的路径</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233039966.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233039966.png#center alt=image-20221214233039966 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>如果没输入密码则无这一步</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233124937.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233124937.png#center alt=image-20221214233124937 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233209994.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233209994.png#center alt=image-20221214233209994 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>测试过程</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233231147.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233231147.png#center alt=image-20221214233231147 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233248106.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233248106.png#center alt=image-20221214233248106 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><blockquote><p><strong>方法二：使用SecureCRT创建秘钥对</strong></p></blockquote><ol><li><strong>选择当前要生成的秘钥窗口，然后点击“工具”中的创建公钥选项，如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233337089.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233337089.png#center alt=image-20221214233337089 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=2><li><strong>秘钥生成向导选择下一步，如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233355827.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233355827.png#center alt=image-20221214233355827 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=3><li><strong>秘钥类型选择DSA或RSA，然后点击下一步，如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233415756.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233415756.png#center alt=image-20221214233415756 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233427261.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233427261.png#center alt=image-20221214233427261 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=4><li><strong>生成秘钥长度，保持默认即可，如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233507874.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233507874.png#center alt=image-20221214233507874 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=5><li><strong>秘钥生成过程，如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233520164.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233520164.png#center alt=image-20221214233520164 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=6><li><strong>秘钥生成后选择下一步，如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233539086.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233539086.png#center alt=image-20221214233539086 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=7><li><strong>秘钥生成后，点击下一步，选择秘钥的私钥保存的路径和，然后点击完成。如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233550840.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233550840.png#center alt=image-20221214233550840 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=8><li><strong>点击完成后，弹出是否使用此秘钥为全局公钥，以个人习惯选择是或否，这里选择否，如下图所示</strong>：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233610803.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233610803.png#center alt=image-20221214233610803 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><ol start=9><li><strong>将SecureCRT生成的公钥上传到linux服务器上</strong></li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233646475.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233646475.png#center alt=image-20221214233646475 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 创建公钥存放目录</span>
</span></span><span class=line><span class=cl>$ mkdir .ssh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改.ssh目录的权限</span>
</span></span><span class=line><span class=cl>$ chmod <span class=m>700</span> .ssh/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看ssh2兼容格式转换成openssh的格式结果</span>
</span></span><span class=line><span class=cl>$ ssh-keygen -i -f Identity.pub  
</span></span><span class=line><span class=cl>ssh-dss AAAAB3NzaC1kc3MAAACBAIJLJsIZJ0G/RKBnWQ04uRfqnv3Vkm8iusrI3Bm784lP64kn/IVZnC/2wcs6xjwjuGFt8GgNVKty+
</span></span><span class=line><span class=cl>s5/jf4uMBse7Ju3alIv42iOmS5+qeztb3Yio1r0rEjLcEdFZVEW3dbVsYX3ufwvBa9GhPum4q3eYwY7TziKR9ub2UJZTqVzAAAAFQDSfk
</span></span><span class=line><span class=cl>HVhjW7J80YBBI2PdqVcRfZ3wAAAIBwmHcLm+BVCcMmpKfYzl+W1/79Cd7vSbeFMW+linn82Li/RcVnWF47hxeKwOwJ/O2UJ879cW1xPUG
</span></span><span class=line><span class=cl>nJUNfEvHJs93rn3zthlbwLCmyH8Ugp2pF38DgyydbU6Xs/6lyiUc14WlzvL3QqO1H+QBX/18ZgXsZjoxakd86pz329r9wTgAAAIAVakBN
</span></span><span class=line><span class=cl>8DtSRZqPLeaXDhevg3texOTlmDsmhmqBcAOmH6VnzP1VB0E8DhTB8/MWJChSJalslyEzaa1PhBNwZEn3SmG6vWe+CXSuEtHBXbVBQHsDb
</span></span><span class=line><span class=cl>xois6L+oqkL86PA7JdzTDSfiZKoGOks5f37Qb+CREnhyYcXJIjPZTE/0aIsdA<span class=o>==</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将ssh2兼容格式转换成openssl的格式结果</span>
</span></span><span class=line><span class=cl>$ ssh-keygen -i -f Identity.pub &gt;&gt;.ssh/authorized_keys
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改公钥的权限</span>
</span></span><span class=line><span class=cl>$ chmod <span class=m>600</span> .ssh/authorized_keys 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看权限是否修改成功</span>
</span></span><span class=line><span class=cl>$ ll .ssh/
</span></span><span class=line><span class=cl>-rw-------. <span class=m>1</span> root root <span class=m>589</span> Jun <span class=m>17</span> 04:37 authorized_keys  </span></span></code></pre></td></tr></table></div></div></div></div><ol start=10><li><strong>测试结果</strong>
新建快速链接，在鉴权中选择公钥，如下图所示：</li></ol><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233705203.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233705203.png#center alt=image-20221214233705203 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233722816.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233722816.png#center alt=image-20221214233722816 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p>如果设置了通行短语，就会出现以下框</p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233734945.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233734945.png#center alt=image-20221214233734945 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><div class=pe-fancybox><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233756074.png><img src=https://cdn.jsdelivr.net/gh/cylonchau/blogs@img/img/image-20221214233756074.png#center alt=image-20221214233756074 onerror='this.onerror=null,this.src="/placeholder.svg",this.className="pe-image-placeholder"'></a></div></p><p><a href=http://blog.51cto.com/phenixikki/1546669 target=_blank rel="noopener nofollow noreferrer">裸奔的后果！一次ssh被篡改的入侵事件</a></p><p>扫描端口实例：牤牛阵解决ssh安全问题</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>sh</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ nmap 192.168.65.62 -p1-65535
</span></span><span class=line><span class=cl>Starting Nmap 5.51 <span class=o>(</span> http://nmap.org <span class=o>)</span> at 2016-06-17 05:11 CST
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 192.168.65.62
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.0000040s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>65532</span> closed ports
</span></span><span class=line><span class=cl>PORT     STATE SERVICE
</span></span><span class=line><span class=cl>22/tcp   open  ssh
</span></span><span class=line><span class=cl>80/tcp   open  http
</span></span><span class=line><span class=cl>3306/tcp open  mysql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap <span class=k>done</span>: <span class=m>1</span> IP address <span class=o>(</span><span class=m>1</span> host up<span class=o>)</span> scanned in 0.79 seconds  </span></span></code></pre></td></tr></table></div></div></div></div></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：SSH服务详解</p><p>文章链接：<a href=https://www.oomkill.com/2016/08/ssh-service/ target=_blank>https://www.oomkill.com/2016/08/ssh-service/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2016/07/scp/><span>使用SSH协议来传输文件</span></a></li><li><a href=/2016/07/expect/><span>expect使用案例</span></a></li><li><a href=/2016/04/syslog/><span>Linux日志管理 - syslog</span></a></li><li><a href=/2016/04/systemd/><span>Linux服务管理 - systemd</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/linux/>Linux</a></li><li><a href=https://www.oomkill.com/tags/ssh/>Ssh</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2016/08/awesome-linux-log-command/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>长期总结 - Linux日志查询命令</span>
</a><a class=next href=https://www.oomkill.com/2016/07/scp/><span class=title></span>
<span>使用SSH协议来传输文件&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/ssh service","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>