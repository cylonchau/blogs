<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>openssl.cnf详解 | Cylon's Collection</title><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP3JNCPR" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta name=keywords content="encryption,openssl"><meta name=description content="下面是一个完整 openssl.cnf 配置文件
ini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 BASE_DOMAIN= CLUSTER_NAME= CERT_DIR= APISERVER_CLUSTER_IP= MASTER_NAME= [ ca ] # man ca default_ca = CA_default [ CA_default ] # Directory and file locations."><meta name=author content="cylon"><link rel=canonical href=https://www.oomkill.com/2024/11/openssl-cnf/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.oomkill.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.oomkill.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.oomkill.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.oomkill.com/favicon.ico><link rel=mask-icon href=https://www.oomkill.com/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://www.oomkill.com/2024/11/openssl-cnf/><noscript><style>#theme-toggle,#top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=/assets/css/pe.min.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/pe.min.js></script><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdn.staticfile.net/font-awesome/6.5.1/css/v4-shims.min.css><script id=MathJax-script async src=https://cdn.staticfile.net/mathjax/3.2.2/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["$$","$$"]],inlineMath:[["\\$","\\$"]]}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-H94HZ5S19Y"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H94HZ5S19Y")</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="openssl.cnf详解"><meta property="og:description" content="下面是一个完整 openssl.cnf 配置文件
ini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 BASE_DOMAIN= CLUSTER_NAME= CERT_DIR= APISERVER_CLUSTER_IP= MASTER_NAME= [ ca ] # man ca default_ca = CA_default [ CA_default ] # Directory and file locations."><meta property="og:type" content="article"><meta property="og:url" content="https://www.oomkill.com/2024/11/openssl-cnf/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-23T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-23T23:00:36+08:00"><meta property="og:site_name" content="Cylon's Collection"><meta name=twitter:card content="summary"><meta name=twitter:title content="openssl.cnf详解"><meta name=twitter:description content="下面是一个完整 openssl.cnf 配置文件
ini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 BASE_DOMAIN= CLUSTER_NAME= CERT_DIR= APISERVER_CLUSTER_IP= MASTER_NAME= [ ca ] # man ca default_ca = CA_default [ CA_default ] # Directory and file locations."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.oomkill.com/posts/"},{"@type":"ListItem","position":2,"name":"openssl.cnf详解","item":"https://www.oomkill.com/2024/11/openssl-cnf/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"openssl.cnf详解","name":"openssl.cnf详解","description":"下面是一个完整 openssl.cnf 配置文件\nini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 BASE_DOMAIN= CLUSTER_NAME= CERT_DIR= APISERVER_CLUSTER_IP= MASTER_NAME= [ ca ] # man ca default_ca = CA_default [ CA_default ] # Directory and file locations.","keywords":["encryption","openssl"],"articleBody":"下面是一个完整 openssl.cnf 配置文件\nini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 BASE_DOMAIN= CLUSTER_NAME= CERT_DIR= APISERVER_CLUSTER_IP= MASTER_NAME= [ ca ] # man ca default_ca = CA_default [ CA_default ] # Directory and file locations. dir = \\${ENV::CERT_DIR} certs = \\$dir crl_dir = \\$dir/crl new_certs_dir = \\$dir database = \\$dir/index.txt serial = \\$dir/serial # certificate revocation lists. crlnumber = \\$dir/crlnumber crl = \\$dir/crl/intermediate-ca.crl crl_extensions = crl_ext default_crl_days = 30 default_md = sha256 name_opt = ca_default cert_opt = ca_default default_days = 375 preserve = no policy = policy_loose [ policy_loose ] # Allow the CA to sign a range of certificates. countryName = optional stateOrProvinceName = optional localityName = optional organizationName = optional organizationalUnitName = optional commonName = supplied emailAddress = optional [ req ] # man req default_bits = 4096 distinguished_name = req_distinguished_name string_mask = utf8only default_md = sha256 [ req_distinguished_name ] countryName = Country Name (2 letter code) stateOrProvinceName = State or Province Name localityName = Locality Name 0.organizationName = Organization Name organizationalUnitName = Organizational Unit Name commonName = Common Name # Certificate extensions (man x509v3_config) [ v3_ca ] subjectKeyIdentifier = hash authorityKeyIdentifier = keyid:always,issuer basicConstraints = critical, CA:true, pathlen:0 keyUsage = critical, digitalSignature, cRLSign, keyCertSign [ client_cert ] basicConstraints = CA:FALSE nsCertType = client nsComment = \"OpenSSL Generated Client Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment extendedKeyUsage = clientAuth, serverAuth subjectAltName = @etcd_client [ server_cert ] basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always keyUsage = critical, digitalSignature, keyEncipherment extendedKeyUsage = serverAuth, clientAuth [ identity_server_cert ] basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always keyUsage = critical, digitalSignature, keyEncipherment extendedKeyUsage = serverAuth subjectAltName = DNS.1:tectonic-identity-api.tectonic-system.svc.cluster.local [ etcd_server_cert ] basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always keyUsage = critical, digitalSignature, keyEncipherment extendedKeyUsage = serverAuth, clientAuth subjectAltName = @etcd_server_and_peer_dns [ etcd_peer_cert ] basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always keyUsage = critical, digitalSignature, keyEncipherment extendedKeyUsage = serverAuth, clientAuth subjectAltName = @etcd_server_and_peer_dns [ apiserver_cert ] basicConstraints = CA:FALSE nsCertType = server nsComment = \"OpenSSL Generated Server Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer:always keyUsage = critical, digitalSignature, keyEncipherment extendedKeyUsage = serverAuth, clientAuth subjectAltName = @apiserver_names [ master_component_client_cert ] basicConstraints = CA:FALSE nsCertType = client nsComment = \"OpenSSL Generated Client Certificate\" subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment extendedKeyUsage = clientAuth subjectAltName = @master_component_names [etcd_server_and_peer_dns] DNS.1 = \\${ENV::BASE_DOMAIN} DNS.2 = localhost IP.1 = 10.0.0.5 IP.2 = 127.0.0.1 IP.3 = 127.0.0.5 [apiserver_names] DNS.1 = \\${ENV::CLUSTER_NAME}-\\${ENV::BASE_DOMAIN} DNS.2 = \\${ENV::BASE_DOMAIN} DNS.3 = kubernetes DNS.4 = kubernetes.default DNS.5 = kubernetes.default.svc DNS.6 = kubernetes.default.svc.cluster.local IP.1 = \\${ENV::APISERVER_CLUSTER_IP} IP.2 = 10.0.0.5 IP.3 = 10.0.0.4 [ master_component_names ] DNS.1 = \\${ENV::MASTER_NAME}.\\${ENV::BASE_DOMAIN} DNS.2 = \\${ENV::BASE_DOMAIN} IP.1 = 10.0.0.5 IP.2 = 10.0.0.4 # used for etcd_client [ etcd_client ] DNS.1 = localhost IP.1 = 10.0.0.5 IP.2 = 10.0.0.4 IP.3 = 10.0.0.6 IP.4 = 127.0.0.1 环境变量部分，用于定义配置文件内的配置会读取这个环境变量来替换\nini 1 2 3 4 5 BASE_DOMAIN= # 基础域名，通常用于 Kubernetes 集群或 API 服务器的域名配置 CLUSTER_NAME= # 集群名称，通常作为集群的标识符 CERT_DIR= # 证书文件存放的目录 APISERVER_CLUSTER_IP= # API 服务器的集群内部 IP 地址 MASTER_NAME= # Kubernetes 主节点的名称 CA 配置部分 指定默认的 CA 配置部分，即下面的 [CA_default] 部分\nconf [ ca ] default_ca = CA_default [CA_default] 部分 该部分定义了 CA (证书颁发机构) 的各种配置参数。\nini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Directory and file locations. dir = \\${ENV::CERT_DIR} # 证书存放的根目录 certs = \\$dir # 证书文件夹 crl_dir = \\$dir/crl # CRL（证书吊销列表）文件夹 new_certs_dir = \\$dir # 新证书文件夹 database = \\$dir/index.txt # 用于存储证书请求、签发等信息的数据库文件 serial = \\$dir/serial # 用于跟踪签发证书的序列号文件 crlnumber = \\$dir/crlnumber # CRL 证书吊销序列号 crl = \\$dir/crl/intermediate-ca.crl # 吊销列表文件 crl_extensions = crl_ext # CRL 扩展配置 default_crl_days = 30 # 默认 CRL 有效期为 30 天 default_md = sha256 # 默认使用 sha256 哈希算法 name_opt = ca_default # 证书的名称选项 cert_opt = ca_default # 证书的选项 default_days = 375 # 证书默认有效期为 375 天 preserve = no # 是否保留 CA 对已签发证书的审计日志 policy = policy_loose # 使用 'policy_loose' 签发证书 [policy_loose] 部分 该部分定义了证书签发策略，允许一些字段为 optional，即证书可以包含这些字段，但不要求必须存在。\nini 1 2 3 4 5 6 7 countryName = optional # 国家名称可选 stateOrProvinceName = optional # 省/州名称可选 localityName = optional # 地市名称可选 organizationName = optional # 组织名称可选 organizationalUnitName = optional # 组织单位名称可选 commonName = supplied # 公共名称是必须提供的（通常是域名或主机名） emailAddress = optional # 邮件地址可选 [req] 和 [req_distinguished_name] 部分 distinguished执意为，显著的，杰出的。用于生成证书请求（CSR）。配置了默认的密钥长度、签名算法等信息。\nini 1 2 3 4 5 6 7 8 9 10 11 12 13 [ req ] default_bits = 4096 # 默认的密钥位数为 4096 位 distinguished_name = req_distinguished_name # 引用 'req_distinguished_name' 部分来定义 DN（区分名称） string_mask = utf8only # 使用 UTF-8 字符编码 default_md = sha256 # 默认使用 sha256 作为散列算法 [ req_distinguished_name ] countryName = Country Name (2 letter code) # 国家（2个字母的国家代码） stateOrProvinceName = State or Province Name # 省/州名称 localityName = Locality Name # 城市/地区名称 0.organizationName = Organization Name # 组织名称 organizationalUnitName = Organizational Unit Name # 组织单位名称 commonName = Common Name # 通用名称（通常是域名或主机名） 证书扩展部分 这些扩展是用于指定证书的用途和其它属性的配置，通常包括证书的使用场景（例如，客户端、服务器认证等）。\n扩展部分的名字，例如[v3_ca] 并不是一个固定的格式，只是一个 OpenSSL 配置文件中的命名部分，通常用于定义颁发 CA（证书颁发机构）证书时所需要的扩展（extensions）。你可以根据需要自定义该部分的内容，但它通常包含一些通用的证书扩展，尤其是 基本约束 (basicConstraints)、密钥用法 (keyUsage) 和 证书签发权限。\n[v3_ca] 部分 该部分用于设置根证书（CA）的扩展，包括证书签发权限、密钥使用等。\nbash 1 2 3 4 5 6 subjectKeyIdentifier = hash # 用于标识证书的主题密钥标识符 authorityKeyIdentifier = keyid:always,issuer # 用于标识证书的颁发者密钥标识符 # 基本约束，标明该证书为 CA 证书，且路径长度为 0（不能作为其他证书的颁发机构） # CA:true 表示这个为ca basicConstraints = critical, CA:true, pathlen:0 keyUsage = critical, digitalSignature, cRLSign, keyCertSign # 证书使用场景：数字签名、证书吊销列表签名、证书签发 客户端、服务器证书扩展部分 这些部分定义了不同类型证书（如客户端证书、服务器证书）的扩展选项：\n[client_cert] 和 [server_cert] 定义了客户端和服务器证书的基本约束和使用场景。 [identity_server_cert] 和 [etcd_server_cert] 定义了特定的服务器证书，通常用于指定 API 服务、etcd 服务等。 这些扩展中的 subjectAltName 字段用于指定证书的备用名称（例如，DNS 或 IP 地址），这是证书有效性的一个重要部分。\nini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 [ client_cert ] # 不允许作为 CA 证书使用 basicConstraints = CA:FALSE # 客户端证书使用场景 keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment # 扩展用途：客户端身份验证、服务器身份验证 extendedKeyUsage = clientAuth, serverAuth # 使用 'etcd_client' 部分中定义内容用作的 SAN 配置 subjectAltName = @etcd_client [ server_cert ] # 不允许作为 CA 证书使用 basicConstraints = CA:FALSE # 服务器证书使用场景 keyUsage = critical, digitalSignature, keyEncipherment # 扩展用途：服务器身份验证、客户端身份验证 extendedKeyUsage = serverAuth, clientAuth # 使用 'etcd_server_and_peer_dns' 配置 subjectAltName = @etcd_server_and_peer_dns keyUsage：通常包括 digitalSignature 和 keyEncipherment，表明证书可以用于签名和加密。 extendedKeyUsage：指定该证书可用于 serverAuth（服务器认证）和 clientAuth（客户端认证）。 subjectAltName：通常会列出服务器的 DNS 名称或 IP 地址，用于验证服务器身份。 当 extendedKeyUsage = serverAuth, clientAuth 同时设定时，表示该证书可以同时用于服务器身份验证和客户端身份验证。这意味着该证书可以被用于 服务器端 来验证客户端的请求，也可以被用作 客户端 来向服务器进行身份验证。例如 Mutual TLS，mTLS。\n单独配置：extendedKeyUsage = serverAuth 或 extendedKeyUsage = clientAuth 时：\nextendedKeyUsage = serverAuth：表示证书的用途是 服务器身份验证，即浏览器可以用它来验证服务器的真实性，确保用户正在访问的是正确的、合法的服务器。此配置通常用于大多数网站的 SSL/TLS 服务器证书。 extendedKeyUsage = clientAuth：表示证书仅用于客户端身份验证，例如用于 SSL/TLS 客户端证书。 Subject Alternative Name (SAN) 部分 SAN 是证书中的一个字段，允许将多个 DNS 名称、IP 地址或 URI 作为证书的有效域名或 IP 地址。它可以包含多个 DNS 名称和 IP 地址。\nini 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [ etcd_server_and_peer_dns ] DNS.1 = \\${ENV::BASE_DOMAIN} # 基础域名 DNS.2 = localhost # 本地主机名 IP.1 = 10.0.0.5 # IP 地址 IP.2 = 127.0.0.1 # 本地回环地址 IP.3 = 127.0.0.5 # 另一个本地回环地址 [ apiserver_names ] # 使用集群名称和基础域名组成的 DNS 名称 # 使用上面的变量 DNS.1 = \\${ENV::CLUSTER_NAME}-\\${ENV::BASE_DOMAIN} # 基础域名 DNS.2 = \\${ENV::BASE_DOMAIN} # API 服务器的 IP 地址 IP.1 = \\${ENV::APISERVER_CLUSTER_IP} # 备用 IP 地址 IP.2 = 10.0.0.5 ","wordCount":"1269","inLanguage":"zh","datePublished":"2024-11-23T00:00:00Z","dateModified":"2024-11-23T23:00:36+08:00","author":{"@type":"Person","name":"cylon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.oomkill.com/2024/11/openssl-cnf/"},"publisher":{"@type":"Organization","name":"Cylon's Collection","logo":{"@type":"ImageObject","url":"https://www.oomkill.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.oomkill.com/><img src=https://www.oomkill.com/favicon.ico alt aria-label=logo height=20>Cylon's Collection</a><div class=logo-switches><button id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.oomkill.com/archives><span>归档</span></a></li><li><a href=https://www.oomkill.com/tags><span>标签</span></a></li><li><a href=https://www.oomkill.com/search><span>搜索</span></a></li><li><a href=https://www.oomkill.com/about accesskey=/><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">openssl.cnf详解</h1><div class=post-meta><span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2024-11-23</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg><span>1269 字</span></span>&nbsp;·&nbsp;<span class=pe-post-meta-item><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>6 分钟</span></span>
<span class=pe-post-meta-item>&nbsp;·&nbsp;<svg t="1714036239378" fill="currentcolor" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="6659" width="256" height="256"><path d="M690 78.2c-18.6-18.8-49-19-67.8-.4s-19 49-.4 67.8l255.4 258.6c67.8 68.6 67.8 178.8.0 247.4L653.4 878.2c-18.6 18.8-18.4 49.2.4 67.8s49.2 18.4 67.8-.4l224-226.4c104.8-106 104.8-276.4.0-382.4L690 78.2zM485.4 101.4c-24-24-56.6-37.4-90.6-37.4H96C43 64 0 107 0 160v299c0 34 13.4 66.6 37.4 90.6l336 336c50 50 131 50 181 0l267-267c50-50 50-131 0-181l-336-336zM96 160h299c8.4.0 16.6 3.4 22.6 9.4l336 336c12.4 12.4 12.4 32.8.0 45.2l-267 267c-12.4 12.4-32.8 12.4-45.2.0l-336-336c-6-6-9.4-14.2-9.4-22.6V160zm192 128a64 64 0 10-128 0 64 64 0 10128 0z" p-id="6660"/></svg></span><ul class=pe-post-meta-item><a href=https://www.oomkill.com/tags/encryption/>#Encryption</a></ul></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details><summary><span class=details>目录</span></summary><div class=inner><ul><ul><li><a href=#ca-%e9%85%8d%e7%bd%ae%e9%83%a8%e5%88%86 aria-label="CA 配置部分">CA 配置部分</a><li><a href=#ca_default-%e9%83%a8%e5%88%86 aria-label="[CA_default] 部分">[CA_default] 部分</a><li><a href=#policy_loose-%e9%83%a8%e5%88%86 aria-label="[policy_loose] 部分">[policy_loose] 部分</a><li><a href=#req-%e5%92%8c-req_distinguished_name-%e9%83%a8%e5%88%86 aria-label="[req] 和 [req_distinguished_name] 部分">[req] 和 [req_distinguished_name] 部分</a></ul><li><a href=#%e8%af%81%e4%b9%a6%e6%89%a9%e5%b1%95%e9%83%a8%e5%88%86 aria-label=证书扩展部分>证书扩展部分</a><ul><li><a href=#v3_ca-%e9%83%a8%e5%88%86 aria-label="[v3_ca] 部分">[v3_ca] 部分</a><li><a href=#%e5%ae%a2%e6%88%b7%e7%ab%af%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%af%81%e4%b9%a6%e6%89%a9%e5%b1%95%e9%83%a8%e5%88%86 aria-label=客户端、服务器证书扩展部分>客户端、服务器证书扩展部分</a></ul><li><a href=#subject-alternative-name-san-%e9%83%a8%e5%88%86 aria-label="Subject Alternative Name (SAN) 部分">Subject Alternative Name (SAN) 部分</a></li></div></details></div></aside><script src=/js/pe-toc.min.445eb1bfc5e85dd13b9519fcc2a806522e9629b6224a2974052789ba00ab78af.js integrity="sha256-RF6xv8XoXdE7lRn8wqgGUi6WKbYiSil0BSeJugCreK8="></script><div class=post-content><p>下面是一个完整 openssl.cnf 配置文件</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ini</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>BASE_DOMAIN</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>CLUSTER_NAME</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>CERT_DIR</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>APISERVER_CLUSTER_IP</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=na>MASTER_NAME</span><span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ ca ]</span>
</span></span><span class=line><span class=cl><span class=c1># man ca</span>
</span></span><span class=line><span class=cl><span class=na>default_ca</span> <span class=o>=</span> <span class=s>CA_default</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ CA_default ]</span>
</span></span><span class=line><span class=cl><span class=c1># Directory and file locations.</span>
</span></span><span class=line><span class=cl><span class=na>dir</span>               <span class=o>=</span> <span class=s>\${ENV::CERT_DIR}</span>
</span></span><span class=line><span class=cl><span class=na>certs</span>             <span class=o>=</span> <span class=s>\$dir</span>
</span></span><span class=line><span class=cl><span class=na>crl_dir</span>           <span class=o>=</span> <span class=s>\$dir/crl</span>
</span></span><span class=line><span class=cl><span class=na>new_certs_dir</span>     <span class=o>=</span> <span class=s>\$dir</span>
</span></span><span class=line><span class=cl><span class=na>database</span>          <span class=o>=</span> <span class=s>\$dir/index.txt</span>
</span></span><span class=line><span class=cl><span class=na>serial</span>            <span class=o>=</span> <span class=s>\$dir/serial</span>
</span></span><span class=line><span class=cl><span class=c1># certificate revocation lists.</span>
</span></span><span class=line><span class=cl><span class=na>crlnumber</span>         <span class=o>=</span> <span class=s>\$dir/crlnumber</span>
</span></span><span class=line><span class=cl><span class=na>crl</span>               <span class=o>=</span> <span class=s>\$dir/crl/intermediate-ca.crl</span>
</span></span><span class=line><span class=cl><span class=na>crl_extensions</span>    <span class=o>=</span> <span class=s>crl_ext</span>
</span></span><span class=line><span class=cl><span class=na>default_crl_days</span>  <span class=o>=</span> <span class=s>30</span>
</span></span><span class=line><span class=cl><span class=na>default_md</span>        <span class=o>=</span> <span class=s>sha256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>name_opt</span>          <span class=o>=</span> <span class=s>ca_default</span>
</span></span><span class=line><span class=cl><span class=na>cert_opt</span>          <span class=o>=</span> <span class=s>ca_default</span>
</span></span><span class=line><span class=cl><span class=na>default_days</span>      <span class=o>=</span> <span class=s>375</span>
</span></span><span class=line><span class=cl><span class=na>preserve</span>          <span class=o>=</span> <span class=s>no</span>
</span></span><span class=line><span class=cl><span class=na>policy</span>            <span class=o>=</span> <span class=s>policy_loose</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ policy_loose ]</span>
</span></span><span class=line><span class=cl><span class=c1># Allow the CA to sign a range of certificates.</span>
</span></span><span class=line><span class=cl><span class=na>countryName</span>             <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName</span>     <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>localityName</span>            <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>organizationName</span>        <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName</span>  <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl><span class=na>commonName</span>              <span class=o>=</span> <span class=s>supplied</span>
</span></span><span class=line><span class=cl><span class=na>emailAddress</span>            <span class=o>=</span> <span class=s>optional</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ req ]</span>
</span></span><span class=line><span class=cl><span class=c1># man req</span>
</span></span><span class=line><span class=cl><span class=na>default_bits</span>        <span class=o>=</span> <span class=s>4096</span>
</span></span><span class=line><span class=cl><span class=na>distinguished_name</span>  <span class=o>=</span> <span class=s>req_distinguished_name</span>
</span></span><span class=line><span class=cl><span class=na>string_mask</span>         <span class=o>=</span> <span class=s>utf8only</span>
</span></span><span class=line><span class=cl><span class=na>default_md</span>          <span class=o>=</span> <span class=s>sha256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ req_distinguished_name ]</span>
</span></span><span class=line><span class=cl><span class=na>countryName</span>                    <span class=o>=</span> <span class=s>Country Name (2 letter code)</span>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName</span>            <span class=o>=</span> <span class=s>State or Province Name</span>
</span></span><span class=line><span class=cl><span class=na>localityName</span>                   <span class=o>=</span> <span class=s>Locality Name</span>
</span></span><span class=line><span class=cl><span class=na>0.organizationName</span>             <span class=o>=</span> <span class=s>Organization Name</span>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName</span>         <span class=o>=</span> <span class=s>Organizational Unit Name</span>
</span></span><span class=line><span class=cl><span class=na>commonName</span>                     <span class=o>=</span> <span class=s>Common Name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Certificate extensions (man x509v3_config)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ v3_ca ]</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid:always,issuer</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>critical, CA:true, pathlen:0</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, digitalSignature, cRLSign, keyCertSign</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ client_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=na>nsCertType</span> <span class=o>=</span> <span class=s>client</span>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;OpenSSL Generated Client Certificate&#34;</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, nonRepudiation, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>clientAuth, serverAuth</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>@etcd_client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ server_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=na>nsCertType</span> <span class=o>=</span> <span class=s>server</span>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;OpenSSL Generated Server Certificate&#34;</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer:always</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>serverAuth, clientAuth</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ identity_server_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=na>nsCertType</span> <span class=o>=</span> <span class=s>server</span>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;OpenSSL Generated Server Certificate&#34;</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer:always</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>serverAuth</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>DNS.1:tectonic-identity-api.tectonic-system.svc.cluster.local</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ etcd_server_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=na>nsCertType</span> <span class=o>=</span> <span class=s>server</span>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;OpenSSL Generated Server Certificate&#34;</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer:always</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>serverAuth, clientAuth</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>@etcd_server_and_peer_dns</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ etcd_peer_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=na>nsCertType</span> <span class=o>=</span> <span class=s>server</span>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;OpenSSL Generated Server Certificate&#34;</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer:always</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>serverAuth, clientAuth</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>@etcd_server_and_peer_dns</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ apiserver_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=na>nsCertType</span> <span class=o>=</span> <span class=s>server</span>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;OpenSSL Generated Server Certificate&#34;</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer:always</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>serverAuth, clientAuth</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>@apiserver_names</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ master_component_client_cert ]</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=na>nsCertType</span> <span class=o>=</span> <span class=s>client</span>
</span></span><span class=line><span class=cl><span class=na>nsComment</span> <span class=o>=</span> <span class=s>&#34;OpenSSL Generated Client Certificate&#34;</span>
</span></span><span class=line><span class=cl><span class=na>subjectKeyIdentifier</span> <span class=o>=</span> <span class=s>hash</span>
</span></span><span class=line><span class=cl><span class=na>authorityKeyIdentifier</span> <span class=o>=</span> <span class=s>keyid,issuer</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, nonRepudiation, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>clientAuth</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>@master_component_names</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[etcd_server_and_peer_dns]</span>
</span></span><span class=line><span class=cl><span class=na>DNS.1</span> <span class=o>=</span> <span class=s>\${ENV::BASE_DOMAIN}</span>
</span></span><span class=line><span class=cl><span class=na>DNS.2</span> <span class=o>=</span> <span class=s>localhost</span>
</span></span><span class=line><span class=cl><span class=na>IP.1</span> <span class=o>=</span> <span class=s>10.0.0.5</span>
</span></span><span class=line><span class=cl><span class=na>IP.2</span> <span class=o>=</span> <span class=s>127.0.0.1</span>
</span></span><span class=line><span class=cl><span class=na>IP.3</span> <span class=o>=</span> <span class=s>127.0.0.5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[apiserver_names]</span>
</span></span><span class=line><span class=cl><span class=na>DNS.1</span> <span class=o>=</span> <span class=s>\${ENV::CLUSTER_NAME}-\${ENV::BASE_DOMAIN}</span>
</span></span><span class=line><span class=cl><span class=na>DNS.2</span> <span class=o>=</span> <span class=s>\${ENV::BASE_DOMAIN}</span>
</span></span><span class=line><span class=cl><span class=na>DNS.3</span> <span class=o>=</span> <span class=s>kubernetes</span>
</span></span><span class=line><span class=cl><span class=na>DNS.4</span> <span class=o>=</span> <span class=s>kubernetes.default</span>
</span></span><span class=line><span class=cl><span class=na>DNS.5</span> <span class=o>=</span> <span class=s>kubernetes.default.svc</span>
</span></span><span class=line><span class=cl><span class=na>DNS.6</span> <span class=o>=</span> <span class=s>kubernetes.default.svc.cluster.local</span>
</span></span><span class=line><span class=cl><span class=na>IP.1</span> <span class=o>=</span> <span class=s>\${ENV::APISERVER_CLUSTER_IP}</span>
</span></span><span class=line><span class=cl><span class=na>IP.2</span> <span class=o>=</span> <span class=s>10.0.0.5</span>
</span></span><span class=line><span class=cl><span class=na>IP.3</span> <span class=o>=</span> <span class=s>10.0.0.4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ master_component_names ]</span>
</span></span><span class=line><span class=cl><span class=na>DNS.1</span> <span class=o>=</span> <span class=s>\${ENV::MASTER_NAME}.\${ENV::BASE_DOMAIN}</span>
</span></span><span class=line><span class=cl><span class=na>DNS.2</span> <span class=o>=</span> <span class=s>\${ENV::BASE_DOMAIN}</span>
</span></span><span class=line><span class=cl><span class=na>IP.1</span> <span class=o>=</span> <span class=s>10.0.0.5</span>
</span></span><span class=line><span class=cl><span class=na>IP.2</span> <span class=o>=</span> <span class=s>10.0.0.4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># used for etcd_client</span>
</span></span><span class=line><span class=cl><span class=k>[ etcd_client ]</span>
</span></span><span class=line><span class=cl><span class=na>DNS.1</span> <span class=o>=</span> <span class=s>localhost</span>
</span></span><span class=line><span class=cl><span class=na>IP.1</span> <span class=o>=</span> <span class=s>10.0.0.5</span>
</span></span><span class=line><span class=cl><span class=na>IP.2</span> <span class=o>=</span> <span class=s>10.0.0.4</span>
</span></span><span class=line><span class=cl><span class=na>IP.3</span> <span class=o>=</span> <span class=s>10.0.0.6</span>
</span></span><span class=line><span class=cl><span class=na>IP.4</span> <span class=o>=</span> <span class=s>127.0.0.1</span></span></span></code></pre></td></tr></table></div></div></div></div><p>环境变量部分，用于定义配置文件内的配置会读取这个环境变量来替换</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ini</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>BASE_DOMAIN</span><span class=o>=</span>                  <span class=s># 基础域名，通常用于 Kubernetes 集群或 API 服务器的域名配置</span>
</span></span><span class=line><span class=cl><span class=na>CLUSTER_NAME</span><span class=o>=</span>                 <span class=s># 集群名称，通常作为集群的标识符</span>
</span></span><span class=line><span class=cl><span class=na>CERT_DIR</span><span class=o>=</span>                     <span class=s># 证书文件存放的目录</span>
</span></span><span class=line><span class=cl><span class=na>APISERVER_CLUSTER_IP</span><span class=o>=</span>         <span class=s># API 服务器的集群内部 IP 地址</span>
</span></span><span class=line><span class=cl><span class=na>MASTER_NAME</span><span class=o>=</span>                  <span class=s># Kubernetes 主节点的名称</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=ca-配置部分>CA 配置部分<a hidden class=anchor aria-hidden=true href=#ca-配置部分>#</a></h4><p>指定默认的 CA 配置部分，即下面的 [CA_default] 部分</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>conf</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><pre tabindex=0><code class=language-conf data-lang=conf>[ ca ]
default_ca = CA_default</code></pre></div></div><h4 id=ca_default-部分>[CA_default] 部分<a hidden class=anchor aria-hidden=true href=#ca_default-部分>#</a></h4><p>该部分定义了 CA (证书颁发机构) 的各种配置参数。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ini</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># Directory and file locations.</span>
</span></span><span class=line><span class=cl><span class=na>dir</span>               <span class=o>=</span> <span class=s>\${ENV::CERT_DIR}    # 证书存放的根目录</span>
</span></span><span class=line><span class=cl><span class=na>certs</span>             <span class=o>=</span> <span class=s>\$dir                 # 证书文件夹</span>
</span></span><span class=line><span class=cl><span class=na>crl_dir</span>           <span class=o>=</span> <span class=s>\$dir/crl             # CRL（证书吊销列表）文件夹</span>
</span></span><span class=line><span class=cl><span class=na>new_certs_dir</span>     <span class=o>=</span> <span class=s>\$dir                 # 新证书文件夹</span>
</span></span><span class=line><span class=cl><span class=na>database</span>          <span class=o>=</span> <span class=s>\$dir/index.txt       # 用于存储证书请求、签发等信息的数据库文件</span>
</span></span><span class=line><span class=cl><span class=na>serial</span>            <span class=o>=</span> <span class=s>\$dir/serial          # 用于跟踪签发证书的序列号文件</span>
</span></span><span class=line><span class=cl><span class=na>crlnumber</span>         <span class=o>=</span> <span class=s>\$dir/crlnumber       # CRL 证书吊销序列号</span>
</span></span><span class=line><span class=cl><span class=na>crl</span>               <span class=o>=</span> <span class=s>\$dir/crl/intermediate-ca.crl  # 吊销列表文件</span>
</span></span><span class=line><span class=cl><span class=na>crl_extensions</span>    <span class=o>=</span> <span class=s>crl_ext               # CRL 扩展配置</span>
</span></span><span class=line><span class=cl><span class=na>default_crl_days</span>  <span class=o>=</span> <span class=s>30                    # 默认 CRL 有效期为 30 天</span>
</span></span><span class=line><span class=cl><span class=na>default_md</span>        <span class=o>=</span> <span class=s>sha256                # 默认使用 sha256 哈希算法</span>
</span></span><span class=line><span class=cl><span class=na>name_opt</span>          <span class=o>=</span> <span class=s>ca_default            # 证书的名称选项</span>
</span></span><span class=line><span class=cl><span class=na>cert_opt</span>          <span class=o>=</span> <span class=s>ca_default            # 证书的选项</span>
</span></span><span class=line><span class=cl><span class=na>default_days</span>      <span class=o>=</span> <span class=s>375                   # 证书默认有效期为 375 天</span>
</span></span><span class=line><span class=cl><span class=na>preserve</span>          <span class=o>=</span> <span class=s>no                    # 是否保留 CA 对已签发证书的审计日志</span>
</span></span><span class=line><span class=cl><span class=na>policy</span>            <span class=o>=</span> <span class=s>policy_loose          # 使用 &#39;policy_loose&#39; 签发证书</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=policy_loose-部分>[policy_loose] 部分<a hidden class=anchor aria-hidden=true href=#policy_loose-部分>#</a></h4><p>该部分定义了证书签发策略，允许一些字段为 <code>optional</code>，即证书可以包含这些字段，但不要求必须存在。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ini</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>countryName</span>             <span class=o>=</span> <span class=s>optional       # 国家名称可选</span>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName</span>     <span class=o>=</span> <span class=s>optional       # 省/州名称可选</span>
</span></span><span class=line><span class=cl><span class=na>localityName</span>            <span class=o>=</span> <span class=s>optional       # 地市名称可选</span>
</span></span><span class=line><span class=cl><span class=na>organizationName</span>        <span class=o>=</span> <span class=s>optional       # 组织名称可选</span>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName</span>  <span class=o>=</span> <span class=s>optional       # 组织单位名称可选</span>
</span></span><span class=line><span class=cl><span class=na>commonName</span>              <span class=o>=</span> <span class=s>supplied       # 公共名称是必须提供的（通常是域名或主机名）</span>
</span></span><span class=line><span class=cl><span class=na>emailAddress</span>            <span class=o>=</span> <span class=s>optional       # 邮件地址可选</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=req-和-req_distinguished_name-部分>[req] 和 [req_distinguished_name] 部分<a hidden class=anchor aria-hidden=true href=#req-和-req_distinguished_name-部分>#</a></h4><p>distinguished执意为，显著的，杰出的。用于生成证书请求（CSR）。配置了默认的密钥长度、签名算法等信息。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ini</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[ req ]</span>
</span></span><span class=line><span class=cl><span class=na>default_bits</span>        <span class=o>=</span> <span class=s>4096           # 默认的密钥位数为 4096 位</span>
</span></span><span class=line><span class=cl><span class=na>distinguished_name</span>  <span class=o>=</span> <span class=s>req_distinguished_name  # 引用 &#39;req_distinguished_name&#39; 部分来定义 DN（区分名称）</span>
</span></span><span class=line><span class=cl><span class=na>string_mask</span>         <span class=o>=</span> <span class=s>utf8only       # 使用 UTF-8 字符编码</span>
</span></span><span class=line><span class=cl><span class=na>default_md</span>          <span class=o>=</span> <span class=s>sha256         # 默认使用 sha256 作为散列算法</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ req_distinguished_name ]</span>
</span></span><span class=line><span class=cl><span class=na>countryName</span>                    <span class=o>=</span> <span class=s>Country Name (2 letter code)  # 国家（2个字母的国家代码）</span>
</span></span><span class=line><span class=cl><span class=na>stateOrProvinceName</span>            <span class=o>=</span> <span class=s>State or Province Name      # 省/州名称</span>
</span></span><span class=line><span class=cl><span class=na>localityName</span>                   <span class=o>=</span> <span class=s>Locality Name               # 城市/地区名称</span>
</span></span><span class=line><span class=cl><span class=na>0.organizationName</span>             <span class=o>=</span> <span class=s>Organization Name           # 组织名称</span>
</span></span><span class=line><span class=cl><span class=na>organizationalUnitName</span>         <span class=o>=</span> <span class=s>Organizational Unit Name    # 组织单位名称</span>
</span></span><span class=line><span class=cl><span class=na>commonName</span>                     <span class=o>=</span> <span class=s>Common Name                 # 通用名称（通常是域名或主机名）</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=证书扩展部分>证书扩展部分<a hidden class=anchor aria-hidden=true href=#证书扩展部分>#</a></h3><p>这些扩展是用于指定证书的用途和其它属性的配置，通常包括证书的使用场景（例如，客户端、服务器认证等）。</p><p>扩展部分的名字，例如<code>[v3_ca]</code> 并不是一个固定的格式，只是一个 OpenSSL 配置文件中的命名部分，通常用于定义颁发 CA（证书颁发机构）证书时所需要的扩展（extensions）。你可以根据需要自定义该部分的内容，但它通常包含一些通用的证书扩展，尤其是 <strong>基本约束</strong> (<code>basicConstraints</code>)、<strong>密钥用法</strong> (<code>keyUsage</code>) 和 <strong>证书签发权限</strong>。</p><h4 id=v3_ca-部分>[v3_ca] 部分<a hidden class=anchor aria-hidden=true href=#v3_ca-部分>#</a></h4><p>该部分用于设置根证书（CA）的扩展，包括证书签发权限、密钥使用等。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>bash</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>subjectKeyIdentifier</span> <span class=o>=</span> <span class=nb>hash</span>                     <span class=c1># 用于标识证书的主题密钥标识符</span>
</span></span><span class=line><span class=cl><span class=nv>authorityKeyIdentifier</span> <span class=o>=</span> keyid:always,issuer    <span class=c1># 用于标识证书的颁发者密钥标识符</span>
</span></span><span class=line><span class=cl><span class=c1># 基本约束，标明该证书为 CA 证书，且路径长度为 0（不能作为其他证书的颁发机构）</span>
</span></span><span class=line><span class=cl><span class=c1># CA:true 表示这个为ca</span>
</span></span><span class=line><span class=cl><span class=nv>basicConstraints</span> <span class=o>=</span> critical, CA:true, pathlen:0  
</span></span><span class=line><span class=cl><span class=nv>keyUsage</span> <span class=o>=</span> critical, digitalSignature, cRLSign, keyCertSign  <span class=c1># 证书使用场景：数字签名、证书吊销列表签名、证书签发</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=客户端服务器证书扩展部分>客户端、服务器证书扩展部分<a hidden class=anchor aria-hidden=true href=#客户端服务器证书扩展部分>#</a></h4><p>这些部分定义了不同类型证书（如客户端证书、服务器证书）的扩展选项：</p><ul><li><strong>[client_cert]</strong> 和 <strong>[server_cert]</strong> 定义了客户端和服务器证书的基本约束和使用场景。</li><li><strong>[identity_server_cert]</strong> 和 <strong>[etcd_server_cert]</strong> 定义了特定的服务器证书，通常用于指定 API 服务、etcd 服务等。</li></ul><p>这些扩展中的 <code>subjectAltName</code> 字段用于指定证书的备用名称（例如，DNS 或 IP 地址），这是证书有效性的一个重要部分。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ini</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[ client_cert ]</span>
</span></span><span class=line><span class=cl><span class=c1># 不允许作为 CA 证书使用</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=c1># 客户端证书使用场景</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, nonRepudiation, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=c1># 扩展用途：客户端身份验证、服务器身份验证</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>clientAuth, serverAuth</span>
</span></span><span class=line><span class=cl><span class=c1># 使用 &#39;etcd_client&#39; 部分中定义内容用作的 SAN 配置</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>@etcd_client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ server_cert ]</span>
</span></span><span class=line><span class=cl><span class=c1># 不允许作为 CA 证书使用</span>
</span></span><span class=line><span class=cl><span class=na>basicConstraints</span> <span class=o>=</span> <span class=s>CA:FALSE</span>
</span></span><span class=line><span class=cl><span class=c1># 服务器证书使用场景</span>
</span></span><span class=line><span class=cl><span class=na>keyUsage</span> <span class=o>=</span> <span class=s>critical, digitalSignature, keyEncipherment</span>
</span></span><span class=line><span class=cl><span class=c1># 扩展用途：服务器身份验证、客户端身份验证</span>
</span></span><span class=line><span class=cl><span class=na>extendedKeyUsage</span> <span class=o>=</span> <span class=s>serverAuth, clientAuth</span>
</span></span><span class=line><span class=cl><span class=c1># 使用 &#39;etcd_server_and_peer_dns&#39; 配置</span>
</span></span><span class=line><span class=cl><span class=na>subjectAltName</span> <span class=o>=</span> <span class=s>@etcd_server_and_peer_dns</span></span></span></code></pre></td></tr></table></div></div></div></div><ul><li><strong>keyUsage</strong>：通常包括 <code>digitalSignature</code> 和 <code>keyEncipherment</code>，表明证书可以用于签名和加密。</li><li><strong>extendedKeyUsage</strong>：指定该证书可用于 <code>serverAuth</code>（服务器认证）和 <code>clientAuth</code>（客户端认证）。</li><li><strong>subjectAltName</strong>：通常会列出服务器的 DNS 名称或 IP 地址，用于验证服务器身份。</li></ul><p>当 <code>extendedKeyUsage = serverAuth, clientAuth</code> 同时设定时，表示该证书可以同时用于服务器身份验证和客户端身份验证。这意味着该证书可以被用于 <strong>服务器端</strong> 来验证客户端的请求，也可以被用作 <strong>客户端</strong> 来向服务器进行身份验证。例如 Mutual TLS，mTLS。</p><p>单独配置：<code>extendedKeyUsage = serverAuth</code> 或 <code>extendedKeyUsage = clientAuth</code> 时：</p><ul><li><strong><code>extendedKeyUsage = serverAuth</code></strong>：表示证书的用途是 <strong>服务器身份验证</strong>，即浏览器可以用它来验证服务器的真实性，确保用户正在访问的是正确的、合法的服务器。此配置通常用于大多数网站的 <strong>SSL/TLS 服务器证书</strong>。</li><li><strong><code>extendedKeyUsage = clientAuth</code></strong>：表示证书仅用于客户端身份验证，例如用于 SSL/TLS 客户端证书。</li></ul><h3 id=subject-alternative-name-san-部分>Subject Alternative Name (SAN) 部分<a hidden class=anchor aria-hidden=true href=#subject-alternative-name-san-部分>#</a></h3><p>SAN 是证书中的一个字段，允许将多个 DNS 名称、IP 地址或 URI 作为证书的有效域名或 IP 地址。它可以包含多个 DNS 名称和 IP 地址。</p><div class="pe-code-block-wrap pe-code-details open scrollable"><div class="pe-code-block-header pe-code-details-summary"><div class=pe-code-block-header-left><i class="arrow fas fa-chevron-right fa-fw pe-code-details-icon" aria-hidden=true></i>
<span>ini</span></div><div class=pe-code-block-header-center><span></span></div><div class=pe-code-block-header-right><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i>
<button class=pe-code-copy-button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon"><path fill="currentcolor" fill-rule="evenodd" d="M7 5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3 3h-2v2a3 3 0 01-3 3H5a3 3 0 01-3-3v-9a3 3 0 013-3h2zm2 2h5a3 3 0 013 3v5h2a1 1 0 001-1V5a1 1 0 00-1-1h-9A1 1 0 009 5zM5 9a1 1 0 00-1 1v9a1 1 0 001 1h9a1 1 0 001-1v-9a1 1 0 00-1-1z" clip-rule="evenodd"/></svg></button></div></div><div class="pe-code-details-content scrollable"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[ etcd_server_and_peer_dns ]</span>
</span></span><span class=line><span class=cl><span class=na>DNS.1</span> <span class=o>=</span> <span class=s>\${ENV::BASE_DOMAIN}             # 基础域名</span>
</span></span><span class=line><span class=cl><span class=na>DNS.2</span> <span class=o>=</span> <span class=s>localhost                        # 本地主机名</span>
</span></span><span class=line><span class=cl><span class=na>IP.1</span> <span class=o>=</span> <span class=s>10.0.0.5                          # IP 地址</span>
</span></span><span class=line><span class=cl><span class=na>IP.2</span> <span class=o>=</span> <span class=s>127.0.0.1                         # 本地回环地址</span>
</span></span><span class=line><span class=cl><span class=na>IP.3</span> <span class=o>=</span> <span class=s>127.0.0.5                         # 另一个本地回环地址</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[ apiserver_names ]</span>
</span></span><span class=line><span class=cl><span class=c1># 使用集群名称和基础域名组成的 DNS 名称</span>
</span></span><span class=line><span class=cl><span class=c1># 使用上面的变量</span>
</span></span><span class=line><span class=cl><span class=na>DNS.1</span> <span class=o>=</span> <span class=s>\${ENV::CLUSTER_NAME}-\${ENV::BASE_DOMAIN}</span>
</span></span><span class=line><span class=cl><span class=c1># 基础域名</span>
</span></span><span class=line><span class=cl><span class=na>DNS.2</span> <span class=o>=</span> <span class=s>\${ENV::BASE_DOMAIN}</span>
</span></span><span class=line><span class=cl><span class=c1># API 服务器的 IP 地址</span>
</span></span><span class=line><span class=cl><span class=na>IP.1</span> <span class=o>=</span> <span class=s>\${ENV::APISERVER_CLUSTER_IP}</span>
</span></span><span class=line><span class=cl><span class=c1># 备用 IP 地址</span>
</span></span><span class=line><span class=cl><span class=na>IP.2</span> <span class=o>=</span> <span class=s>10.0.0.5</span></span></span></code></pre></td></tr></table></div></div></div></div></div><div class=pe-copyright><hr><blockquote><p>本文为原创内容，版权归作者所有。如需转载，请在文章中声明本文标题及链接。</p><p>文章标题：openssl.cnf详解</p><p>文章链接：<a href=https://www.oomkill.com/2024/11/openssl-cnf/ target=_blank>https://www.oomkill.com/2024/11/openssl-cnf/</a></p><p>许可协议：<a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></p></blockquote></div><div class=comments-separator></div><h3 class=relatedContentTitle>相关阅读</h3><ul class=relatedContent><li><a href=/2020/08/openssl-x509/><span>常用加密算法之数字证书与TLS/SSL</span></a></li><li><a href=/2020/11/hash-function/><span>常用加密算法学习总结之散列函数(hash function)</span></a></li><li><a href=/2020/11/digital-signature/><span>常用加密算法学习总结之数字签名</span></a></li><li><a href=/2020/11/asymmetric/><span>常用加密算法学习总结之非对称加密</span></a></li><li><a href=/2020/10/symmetric/><span>常用加密算法学习总结之对称加密</span></a></li></ul><div class=comments-separator></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.oomkill.com/tags/encryption/>Encryption</a></li></ul><nav class=paginav><a class=prev href=https://www.oomkill.com/2024/11/k8s-auth-and-regenerate-cert/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></polyline></svg>&nbsp;</span>
<span>TLS Everywhere - 解密kubernetes集群的安全认证</span>
</a><a class=next href=https://www.oomkill.com/2024/11/zk-upgrade-3.4-to-3.6/><span class=title></span>
<span>zookeeper版本升级 - from 3.4 to 3.8&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span></a></nav></footer><div class=pe-comments-decoration><p class=pe-comments-title></p><p class=pe-comments-subtitle></p></div><div id=pe-comments></div><script src=/js/pe-go-comment.min.86a214102576ba5f9b7bdc29eed8d58dd56e34aef80b3c65c73ea9cc88443696.js integrity="sha256-hqIUECV2ul+be9wp7tjVjdVuNK74Czxlxz6pzIhENpY="></script><script>const getStoredTheme=()=>localStorage.getItem("pref-theme")==="dark"?"dark":"light",setGiscusTheme=()=>{const e=e=>{const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")};e({setConfig:{theme:getStoredTheme()}})};document.addEventListener("DOMContentLoaded",()=>{const s={src:"https://giscus.app/client.js","data-repo":"cylonchau/blogs","data-repo-id":"R_kgDOIRlNSQ","data-category":"Announcements","data-category-id":"DIC_kwDOIRlNSc4CXy1U","data-mapping":"pathname","data-term":"posts/openssl-cnf","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":getStoredTheme(),"data-lang":"zh-TW","data-loading":"lazy",crossorigin:"anonymous",async:""},e=document.createElement("script");Object.entries(s).forEach(([t,n])=>e.setAttribute(t,n)),document.querySelector("#pe-comments").appendChild(e);const t=document.querySelector("#theme-toggle");t&&t.addEventListener("click",setGiscusTheme);const n=document.querySelector("#theme-toggle-float");n&&n.addEventListener("click",setGiscusTheme)})</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.oomkill.com/>Cylon's Collection</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> on
<a href=https://pages.github.com/ rel=noopener target=_blank>GitHub Pages</a> & Theme
        <a href=https://github.com/tofuwine/PaperMod-PE rel=noopener target=_blank>PaperMod-PE</a></span></footer><div class=pe-right-sidebar><a href=javascript:void(0); id=theme-toggle-float class=pe-float-btn><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</a><a href=#top class=pe-float-btn id=top-link><span id=pe-read-progress></span></a></div><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>